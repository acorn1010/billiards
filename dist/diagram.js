"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[465],{"./src/diagrams.ts":(e,t,n)=>{var i,a,o,r,s,l,u,c,h,f=n("./src/model/table.ts"),d=n("./src/view/tablegeometry.ts");function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),p(this,"state",void 0),p(this,"control",void 0),this.state=e,this.control=t,this.addControls(t,i)}return e=[{key:"readValue",value:function(e){var t=this.control.querySelector(e);return t?t.valueAsNumber:0}},{key:"readControls",value:function(){var e=this.state.balls[0];e.pos.x=this.readValue("#x"),e.pos.y=this.readValue("#y"),e.vel.x=this.readValue("#vx"),e.vel.y=this.readValue("#vy"),e.rvel.x=this.readValue("#wx"),e.rvel.y=this.readValue("#wy"),e.rvel.z=this.readValue("#wz")}},{key:"addControls",value:function(e,t){var n=this.state.balls[0],i='type="number" step="0.1"';e.innerHTML='\n        x <input id="x" '.concat(i,' value="').concat(n.pos.x,'">\n		  <input id="y" ').concat(i,' value="').concat(n.pos.y,'">\n        ẋ <input id="vx" ').concat(i,' value="').concat(n.vel.x,'">\n		  <input id="vy" ').concat(i,' value="').concat(n.vel.y,'">\n        ω <input id="wx" ').concat(i,' value="').concat(n.rvel.x,'">\n		  <input id="wy" ').concat(i,' value="').concat(n.rvel.y,'">\n          <input id="wz" ').concat(i,' value="').concat(n.rvel.z,'"><button type="button">replay</button>'),e.getElementsByTagName("button")[0].onclick=t}}],v(n.prototype,e),t&&v(n,t),n}();function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){var e,t;function n(e,t,i){var a=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),m(this,"table",void 0),m(this,"diagram",void 0),m(this,"diagramInputs",void 0),m(this,"last",performance.now()),m(this,"step",.001),m(this,"tablecolor","#0a5c5c"),m(this,"colors",["#aaaaaa","#ff0000","#ffff00"]),this.table=f.i.fromSerialised(e),this.diagram=t,this.diagramInputs=new y(e,i,function(){return a.restart()}),this.scale(),this.drawTable(),this.animate(this.last)}return e=[{key:"scale",value:function(){var e=this.diagram.canvas.clientWidth,t=this.diagram.canvas.clientHeight,n=.45*e/d.H.X;this.diagram.setTransform(n,0,0,n,.5*e,.5*t)}},{key:"drawTable",value:function(){var e=d.H.X,t=d.H.Y;this.diagram.fillStyle=this.tablecolor,this.diagram.fillRect(-e,-t,2*e,2*t)}},{key:"drawBall",value:function(e,t,n){this.diagram.fillStyle=n,this.diagram.beginPath(),this.diagram.ellipse(e,t,.5,.5,0,0,2*Math.PI),this.diagram.fill()}},{key:"drawBalls",value:function(){var e=this,t=0;this.table.balls.forEach(function(n){return e.drawBall(n.pos.x,n.pos.y,e.colors[t++])})}},{key:"clearBalls",value:function(){var e=this;this.table.balls.forEach(function(t){return e.drawBall(t.pos.x,t.pos.y,e.tablecolor)})}},{key:"advance",value:function(e){for(var t=Math.floor(e/this.step),n=0;n<t;n++)this.table.advance(this.step)}},{key:"animate",value:function(e){var t=this;this.clearBalls(),this.advance((e-this.last)/1e3),this.last=e,this.drawBalls(),this.table.allStationary()||requestAnimationFrame(function(e){t.animate(e)})}},{key:"restart",value:function(){this.diagramInputs.readControls(),this.table.updateFromSerialised(this.diagramInputs.state),this.drawTable(),this.last=performance.now(),this.animate(this.last)}}],k(n.prototype,e),t&&k(n,t),n}(),w=n("./src/model/physics/physics.ts"),g=n("./node_modules/three/build/three.module.js");function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),P(this,"canvas",void 0),P(this,"context",void 0),P(this,"endx",100),P(this,"endy",100),P(this,"scale",75),P(this,"r",20),P(this,"dv",new g.Pa4),P(this,"dw",new g.Pa4),e.firstElementChild.innerHTML=t,this.canvas=e.lastElementChild,this.context=this.canvas.getContext("2d")}return e=[{key:"drawBall",value:function(){this.context.beginPath(),this.context.strokeStyle="lightgray",this.context.fillStyle="beige",this.context.arc(this.endx,this.endy,this.r,0,2*Math.PI,!1),this.context.fill(),this.context.stroke()}},{key:"drawCushion",value:function(){var e=this.context.createLinearGradient(10,90,200,90);e.addColorStop(0,"lightgray"),e.addColorStop(.75,"white"),this.context.fillStyle=e,this.context.fillRect(this.endx+this.r,10,200,250)}},{key:"plot",value:function(e,t,n,i,a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCushion(),this.drawBall();for(var o=e;o<=t;o+=n){var r=i(o),s=a(o),l=(0,w.vZ)(r,s)?[]:[2,2];this.context.setLineDash(l);var u=(o+360)*101%360;this.context.strokeStyle="hsl(".concat(u,",50%,50%)"),this.drawArrow(this.endx-r.x*this.scale,this.endy-r.y*this.scale,this.endx,this.endy),(0,w.ZI)(0,r,s,this.dv,this.dw),r.add(this.dv),this.drawArrow(this.endx,this.endy,this.endx+r.x*this.scale,this.endy+r.y*this.scale)}}},{key:"drawArrow",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.9,o={dx:n-e,dy:i-t},r={x:o.dx*a+e,y:o.dy*a+t},s={dx:n-r.x,dy:i-r.y};this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(r.x,r.y),this.context.moveTo(r.x+.5*s.dy,r.y-.5*s.dx),this.context.lineTo(r.x-.5*s.dy,r.y+.5*s.dx),this.context.lineTo(n,i),this.context.closePath(),this.context.stroke()}}],x(n.prototype,e),t&&x(n,t),n}();function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function A(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var E=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),M(this,"canvas",void 0),M(this,"ctx",void 0),M(this,"xAxis",void 0),M(this,"yAxis",void 0),M(this,"gutter",20),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvas.previousElementSibling.innerHTML=t,this.canvas.nextElementSibling.innerHTML=i}return e=[{key:"plot",value:function(e,t,n){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.shadowColor="grey",this.ctx.shadowBlur=2,this.xAxis=this.axisInfo(e,this.canvas.width),this.yAxis=this.axisInfo(T(t).concat(T(n)),this.canvas.height),this.drawXAxis(e),this.plotLine(e,t,"blue"),this.plotLine(e,n,"red")}},{key:"plotLine",value:function(e,t,n){this.ctx.beginPath();for(var i=0;i<e.length;i++){var a=this.scale(e[i],this.xAxis),o=this.canvas.height-.8*this.scale(t[i],this.yAxis)-this.gutter;0===i?this.ctx.moveTo(a,o):this.ctx.lineTo(a,o)}this.ctx.strokeStyle=n,this.ctx.stroke()}},{key:"drawXAxis",value:function(e){var t=this.canvas.height-this.gutter;this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.strokeStyle="grey",this.ctx.stroke(),this.ctx.font="8px Arial",this.ctx.strokeStyle="grey";for(var n=!1,i=2;i<e.length-2;i++){var a=this.scale(e[i],this.xAxis);this.ctx.beginPath(),this.ctx.moveTo(a,t),this.ctx.lineTo(a,t+4),this.ctx.stroke(),n||this.ctx.fillText(e[i],a-5,t+10),n=!n}}},{key:"scale",value:function(e,t){return(e-t.min)*t.scale}},{key:"axisInfo",value:function(e,t){var n,i,a=(n=Math).min.apply(n,T(e)),o=(i=Math).max.apply(i,T(e));return{min:a,max:o,scale:t/(o-a||1)}}}],A(n.prototype,e),t&&A(n,t),n}(),I=n("./src/model/ball.ts"),C=n("./src/model/physics/constants.ts"),j=n("./src/utils/utils.ts");function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),B(this,"ball",void 0),B(this,"theta",0),B(this,"canvas",void 0),B(this,"ctx",void 0),B(this,"step",.01),this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.ball=new I.e(j.bM),this.ball.vel=new g.Pa4(8.5,0,0),this.ball.rvel=new g.Pa4(0,0*this.ball.vel.x/C.R,0),this.ball.state=I.Z.Sliding}return e=[{key:"drawBall",value:function(e,t,n){var i=this.canvas.width,a=this.canvas.height,o=i/(27*C.R);this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n;var r=e*o+2*C.R*o,s=t*o+a/2,l=C.R*o;this.ctx.ellipse(r,s,l,l,0,0,2*Math.PI),this.ctx.stroke();var u=r+-(C.R*Math.sin(this.theta))*o,c=s+C.R*Math.cos(this.theta)*o;this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(r,s),this.ctx.lineTo(u,c),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="black",this.ctx.arc(u,c,3,0,2*Math.PI),this.ctx.fill()}},{key:"advance",value:function(e){this.ball.update(e);var t=this.ball.rvel.length()*e;this.theta+=t}},{key:"draw",value:function(e){this.ctx.clearRect(0,0,1,1);for(var t=0;t<e;){var n="blue";this.ball.isRolling()?n="red":this.ball.inMotion()&&(n="green"),this.drawBall(this.ball.pos.x,0,n),this.advance(this.step),t+=this.step}}}],O(n.prototype,e),t&&O(n,t),n}(),N=n("./src/view/sliders.ts"),z=1,Y=K("rollcanvas");function V(){var e,t;e=function(e){return function(t){return new g.Pa4(0,0,e)}},t=function(e){return new g.Pa4(Math.cos(e*Math.PI/180),Math.sin(e*Math.PI/180),0)},i.plot(10,80,10,t,function(e){return new g.Pa4(0,0,0)}),a.plot(10,80,10,t,e(-3)),o.plot(10,80,10,t,e(3)),r.plot(-6,6,1,function(e){return new g.Pa4(.7,.7,0)},function(e){return new g.Pa4(0,0,e)}),s.plot(-6,6,1,function(e){return new g.Pa4(2,2,0)},function(e){return new g.Pa4(0,0,e)}),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),o=new g.Pa4(0,0,i);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,o)))}l.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),o=new g.Pa4(0,i,0);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,o)))}u.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-80;i<=80;i+=10){e.push(i);var a=i*Math.PI/180,o=new g.Pa4(Math.cos(a),Math.sin(a),0);o.multiplyScalar(z);var r=new g.Pa4(0,0,-10);t.push((0,w.NP)((0,w.c0)(o))),n.push((0,w.al)((0,w.s0)(o,r)))}c.plot(e,t,n)}(),function(){for(var e=[],t=[],n=-80;n<=80;n+=10){e.push(n);var i=n*Math.PI/180,a=new g.Pa4(Math.cos(i),Math.sin(i),0),o=(0,w.GK)(a);t.push(o)}h.plot(e,t,t)}()}function F(e,t){return new b({balls:t},L(e,"canvas").getContext("2d"),L(e,"control"))}function X(e,t,n,i,a,o,r){return{pos:{x:e,y:t,z:0},vel:{x:n,y:i,z:0},rvel:{x:a,y:o,z:r},state:"Sliding"}}function K(e){return document.getElementById(e)}function L(e,t){var n="#"+e+" #"+t,i=document.querySelector(n);if(null==i)throw Error("Element not found "+n);return i}Y?new H(Y).draw(5):(F("diagram1",[X(0,0,-20,0,0,0,0),X(2,2,-20,0,0,0,20),X(-2,-2,-20,0,0,0,-20)]),F("diagram2",[X(-17,2,0,-40,-85,0,-35),X(-17.38,-2,0,0,0,0,0)]),i=new S(K("cushion1"),"stun shot"),a=new S(K("cushion2"),"running side"),o=new S(K("cushion3"),"check side"),r=new S(K("cushion4"),"varying side"),s=new S(K("cushion5"),"varying side high vel"),l=new E("plot1","Spinning ball played slowly directly into cushion","top/back spin w.y"),u=new E("plot2","Spinning ball played hard directly into cushion","top/back spin w.y"),c=new E("plot3","Right hand spinning ball with varying incident angle","Incident angle (degrees) of ball to cushion with right side"),h=new E("plot4","Cushion friction (mu) varies with incident angle","Incident angle (degrees) of ball to cushion"),V(),new N.E(V).initialiseSider("s",z,function(e){z=e}))},"./src/events/aimevent.ts":(e,t,n)=>{n.d(t,{f:()=>f});var i=n("./src/events/gameevent.ts"),a=n("./src/events/eventtype.ts"),o=n("./src/utils/utils.ts"),r=n("./node_modules/three/build/three.module.js");function s(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(d,e);var t,n,i,f=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n,i=c(d);if(t){var a=c(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return(e=n)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:s(this)});function d(){var e;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d),u(s(e=f.call(this)),"offset",new r.Pa4(0,0,0)),u(s(e),"angle",0),u(s(e),"power",0),u(s(e),"pos",new r.Pa4(0,0,0)),u(s(e),"i",0),e.type=a.t.AIM,e}return n=[{key:"applyToController",value:function(e){return e.handleAim(this)}},{key:"copy",value:function(){return d.fromJson(this)}},{key:"round",value:function(){this.angle=(0,o.NM)(this.angle),this.power=(0,o.NM)(this.power),this.offset=(0,o.wK)(this.offset)}}],i=[{key:"fromJson",value:function(e){var t=new d;return t.pos=(0,o.Bh)(e.pos),t.angle=e.angle,t.offset=(0,o.Bh)(e.offset),t.power=e.power,e.i&&(t.i=e.i),t}}],n&&l(d.prototype,n),i&&l(d,i),d}(i.Z)},"./src/events/eventtype.ts":(e,t,n)=>{var i;n.d(t,{t:()=>i}),function(e){e.BEGIN="BEGIN",e.BREAK="BREAK",e.WATCHAIM="WATCHAIM",e.AIM="AIM",e.HIT="HIT",e.STATIONARY="STATIONARY",e.CHAT="CHAT",e.ABORT="ABORT",e.PLACEBALL="PLACEBALL",e.REJOIN="REJOIN"}(i||(i={}))},"./src/events/gameevent.ts":(e,t,n)=>{function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:()=>a});var a=function e(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),i(this,"type",void 0),i(this,"sequence",void 0)}},"./src/model/ball.ts":(e,t,n)=>{n.d(t,{e:()=>y,Z:()=>i});var i,a=n("./src/utils/utils.ts"),o=n("./src/model/physics/physics.ts"),r=n("./node_modules/three/build/three.module.js"),s=n("./src/model/physics/constants.ts");function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),u(this,"line",void 0),u(this,"geometry",void 0),u(this,"positions",void 0),u(this,"lastPos",new r.Pa4),u(this,"lastVel",new r.Pa4),this.geometry=new r.u9r,this.positions=new Float32Array(3*e),this.geometry.setAttribute("position",new r.TlE(this.positions,3)),this.reset();var i=new r.nls({color:t,opacity:.25,linewidth:3,transparent:!0});this.line=new r.x12(this.geometry,i),this.line.visible=!1}return e=[{key:"reset",value:function(){this.geometry.setDrawRange(0,0)}},{key:"addTrace",value:function(e,t){if(0!==t.length()){var n=this.lastVel.angleTo(t),i=n>Math.PI/32?.01*s.R:s.R;if(!(this.lastPos.distanceTo(e)<i)){var a=this.geometry.drawRange.count;a>2&&n<1e-4&&a--,this.lastPos.copy(e),this.lastVel.copy(t),this.addPoint(e,a)}}}},{key:"addPoint",value:function(e,t){var n=3*t;n>this.positions.length||(this.positions[n++]=e.x,this.positions[n++]=e.y,this.positions[n]=e.z,this.geometry.setDrawRange(0,t+1),this.line.geometry.attributes.position.needsUpdate=!0)}}],l(n.prototype,e),t&&l(n,t),n}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),f(this,"mesh",void 0),f(this,"shadow",void 0),f(this,"spinAxisArrow",void 0),f(this,"trace",void 0),f(this,"m",new r.yGw),this.initialiseMesh(e)}return e=[{key:"updateAll",value:function(e,t){this.updatePosition(e.pos),this.updateArrows(e.pos,e.rvel,e.state),0!==e.rvel.lengthSq()&&this.updateRotation(e.rvel,t),this.trace.addTrace(e.pos,e.vel)}},{key:"updatePosition",value:function(e){this.mesh.position.copy(e),this.shadow.position.copy(e)}},{key:"updateRotation",value:function(e,t){var n=e.length()*t,i=this.m.identity().makeRotationAxis((0,a.KO)(e),n);this.mesh.geometry.applyMatrix4(i)}},{key:"updateArrows",value:function(e,t,n){this.spinAxisArrow.setLength(s.R+s.R*t.length()/2,s.R,s.R),this.spinAxisArrow.position.copy(e),this.spinAxisArrow.setDirection((0,a.KO)(t)),n==i.Rolling?this.spinAxisArrow.setColor(13369344):this.spinAxisArrow.setColor(52224)}},{key:"initialiseMesh",value:function(e){var t=new r.cJO(s.R,1),n=new r.xoR({emissive:0,flatShading:!0,vertexColors:!0});this.addDots(t,e),this.mesh=new r.Kj0(t,n),this.mesh.name="ball",this.updateRotation(new r.Pa4().random(),100);var i=new r.zf8(.9*s.R,9);i.applyMatrix4(new r.yGw().identity().makeTranslation(0,0,-(.99*s.R)));var o=new r.vBJ({color:1118498});this.shadow=new r.Kj0(i,o),this.spinAxisArrow=new r.tGC(a.up,a.bM,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.trace=new c(500,e)}},{key:"addDots",value:function(e,t){var n=this,i=e.attributes.position.count,a=new r.Ilk(t),o=new r.Ilk(11149858);e.setAttribute("color",new r.TlE(new Float32Array(3*i),3));for(var s=e.attributes.color,l=0;l<i/3;l++)this.colorVerticesForFace(l,s,this.scaleNoise(a.r),this.scaleNoise(a.g),this.scaleNoise(a.b));[0,96,111,156,186,195].forEach(function(e){n.colorVerticesForFace(e/3,s,o.r,o.g,o.b)})}},{key:"addToScene",value:function(e){e.add(this.mesh),e.add(this.shadow),e.add(this.spinAxisArrow),e.add(this.trace.line)}},{key:"colorVerticesForFace",value:function(e,t,n,i,a){t.setXYZ(3*e+0,n,i,a),t.setXYZ(3*e+1,n,i,a),t.setXYZ(3*e+2,n,i,a)}},{key:"scaleNoise",value:function(e){return(1-.25*Math.random())*e}}],h(n.prototype,e),t&&h(n,t),n}();function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Stationary="Stationary",e.Rolling="Rolling",e.Sliding="Sliding",e.Falling="Falling",e.InPocket="InPocket"}(i||(i={}));var y=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),p(this,"pos",void 0),p(this,"vel",a.bM.clone()),p(this,"rvel",a.bM.clone()),p(this,"futurePos",a.bM.clone()),p(this,"ballmesh",void 0),p(this,"state",i.Stationary),p(this,"pocket",void 0),p(this,"transition",.05),this.pos=e.clone(),this.ballmesh=new d(t||5592405*Math.random())}return e=[{key:"update",value:function(e){this.updatePosition(e),this.updateVelocity(e),this.updateFalling(e)}},{key:"updateMesh",value:function(e){this.ballmesh.updateAll(this,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e)}},{key:"updateFalling",value:function(e){this.state==i.Falling&&this.pocket.updateFall(this,e)}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?(this.state=i.Rolling,this.addDelta(e,(0,o.QC)(this.rvel))):(this.state=i.Sliding,this.addDelta(e,(0,o.Vp)(this.vel,this.rvel))))}},{key:"addDelta",value:function(e,t){t.v.multiplyScalar(e),t.w.multiplyScalar(e),this.passesZero(t)||(this.vel.add(t.v),this.rvel.add(t.w))}},{key:"passesZero",value:function(e){var t=(0,a.Ls)(this.vel,e.v),n=(0,a.Ls)(this.rvel,e.w),o=this.state===i.Rolling?t||n:t&&n;return o&&this.setStationary(),o}},{key:"setStationary",value:function(){this.vel.copy(a.bM),this.rvel.copy(a.bM),this.state=i.Stationary}},{key:"isRolling",value:function(){return 0!=this.vel.lengthSq()&&0!=this.rvel.lengthSq()&&(0,o.E9)(this.vel,this.rvel).length()<this.transition}},{key:"onTable",value:function(){return this.state!==i.Falling&&this.state!==i.InPocket}},{key:"inMotion",value:function(){return this.state==i.Rolling||this.state==i.Sliding}},{key:"isFalling",value:function(){return this.state==i.Falling}},{key:"futurePosition",value:function(e){return this.futurePos.copy(this.pos).addScaledVector(this.vel,e),this.futurePos}},{key:"serialise",value:function(){return{pos:this.pos,vel:this.vel,rvel:this.rvel,state:this.state}}}],t=[{key:"fromSerialised",value:function(e){return n.updateFromSerialised(new n((0,a.Bh)(e.pos)),e)}},{key:"updateFromSerialised",value:function(e,t){return e.pos.copy(t.pos),e.vel.copy((0,a.Bh)(t.vel)),e.rvel.copy((0,a.Bh)(t.rvel)),e.state=t.state,e}}],e&&v(n.prototype,e),t&&v(n,t),n}()},"./src/model/outcome.ts":(e,t,n)=>{function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{k:()=>o}),function(e){e.Pot="Pot",e.Cushion="Cushion",e.Collision="Collision",e.Hit="Hit"}(a||(a={}));var a,o=function(){var e;function t(e,n,a,o){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),i(this,"type",void 0),i(this,"timestamp",void 0),i(this,"ballA",null),i(this,"ballB",null),i(this,"incidentSpeed",void 0),this.type=e,this.ballA=n,this.ballB=a,this.incidentSpeed=o,this.timestamp=Date.now()}return e=[{key:"pot",value:function(e,n){return new t(a.Pot,e,e,n)}},{key:"cushion",value:function(e,n){return new t(a.Cushion,e,e,n)}},{key:"collision",value:function(e,n,i){return new t(a.Collision,e,n,i)}},{key:"hit",value:function(e,n){return new t(a.Hit,e,e,n)}},{key:"isCueBallPotted",value:function(e,t){return t.some(function(t){return t.type==a.Pot&&t.ballA===e})}},{key:"isBallPottedNoFoul",value:function(e,n){return n.some(function(e){return e.type==a.Pot&&null!==e.ballA})&&!t.isCueBallPotted(e,n)}},{key:"isThreeCushionPoint",value:function(e,n){n=t.cueBallFirst(e,n).filter(function(t){return t.ballA===e});var i=new Set,o=0,r=!0,s=!1,l=void 0;try{for(var u,c=n[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var h=u.value;if(h.type===a.Cushion&&o++,h.type===a.Collision&&(i.add(h.ballB),2===i.size))return o>=3}}catch(e){s=!0,l=e}finally{try{r||null==c.return||c.return()}finally{if(s)throw l}}return!1}},{key:"cueBallFirst",value:function(e,t){return t.forEach(function(t){t.type===a.Collision&&t.ballB===e&&(t.ballB=t.ballA,t.ballA=e)}),t}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}()},"./src/model/physics/constants.ts":(e,t,n)=>{n.d(t,{Dt:()=>u,Ew:()=>p,G3:()=>w,Hz:()=>a,I:()=>o,Mz:()=>i,R:()=>f,Xm:()=>g,_5:()=>c,dE:()=>k,e:()=>d,f7:()=>b,fN:()=>y,g:()=>r,m:()=>h,mu:()=>s,zq:()=>m,zv:()=>l});var i,a,o,r=9.8,s=.01,l=.1,u=.3,c=.025,h=.22,f=.022,d=.86;function v(){i=s*h*r*2/3*c,a=7/(5*Math.sqrt(2))*f*s*h*r,o=.4*h*f*f}function p(e){f=e,v()}function y(e){h=e,v()}function k(e){s=e,v()}function m(e){c=e,v()}function b(e){l=e}function w(e){d=e}function g(e){u=e}v()},"./src/model/physics/knuckle.ts":(e,t,n)=>{n.d(t,{T:()=>s});var i=n("./src/model/physics/constants.ts"),a=n("./src/view/pocketgeometry.ts");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),r(this,"pos",void 0),r(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"bounce",value:function(e){var t=e.pos.clone().sub(this.pos).normalize(),n=t.dot(e.vel);return e.vel.addScaledVector(t,-2*i.e*n),Math.abs(n)}}],t=[{key:"willBounce",value:function(e,t){return t.distanceTo(e.pos)<i.R+e.radius}},{key:"findBouncing",value:function(e,t){var i=e.futurePosition(t);return a.u.knuckles.find(function(e){return n.willBounce(e,i)})}}],e&&o(n.prototype,e),t&&o(n,t),n}()},"./src/model/physics/physics.ts":(e,t,n)=>{n.d(t,{E9:()=>r,GK:()=>b,NP:()=>k,QC:()=>u,Vp:()=>l,WL:()=>w,ZI:()=>c,al:()=>y,c0:()=>p,s0:()=>v,vZ:()=>m});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/utils/utils.ts"),o=n("./src/model/physics/constants.ts");function r(e,t){return e.clone().addScaledVector((0,a.a1)(t),o.R)}var s={v:new i.Pa4,w:new i.Pa4};function l(e,t){var n=r(e,t).setZ(0);return s.v.copy((0,a.KO)(n).multiplyScalar(-o.zv*o.g)),s.w.copy((0,a.KO)((0,a.a1)(n)).multiplyScalar(2.5*o.zv*o.g/o.R)),s.w.setZ(-2.5*(o.Mz/(o.R*o.R))*Math.sign(t.z)),s}function u(e){var t=new i.Pa4(e.x,e.y,0).length(),n=5/7*o.Hz/(o.m*o.R)/t,a=5/7*o.Hz/(o.m*o.R*o.R)/t;return s.v.set(-n*e.y,n*e.x,0),s.w.set(-a*e.x,-a*e.y,-2.5*(o.Mz/(o.m*o.R*o.R))*Math.sign(e.z)),s}function c(e,t,n,i,r){(function(e,t,n,i){var a,r,s=p(e),l=v(e,t),u=k(s),c=y(l),h=3.5/o.m,m=1/o.m,w=(1+o.e)*(s/m),g=0;if(c<u)a=-l.x/h*f-w*d,r=l.y/h,g=l.x/h*d-w*f;else{var x=b(e),P=Math.abs(Math.atan2(e.y,e.x)),S=Math.cos(P);a=-x*w*S*d-w*d,r=x*w*Math.sin(P),g=x*w*S*d-w*f}n.x=a/o.m,n.y=r/o.m,i.x=-o.R/o.I*r*f,i.y=o.R/o.I*(a*f-g*d),i.z=o.R/o.I*r*d})(t.clone().applyAxisAngle(a.up,e),n.clone().applyAxisAngle(a.up,e),i,r),i.applyAxisAngle(a.up,-e),r.applyAxisAngle(a.up,-e)}Object.freeze(s);var h=Math.asin(.2*o.R/o.R),f=Math.sin(h),d=Math.cos(h);function v(e,t){return new i.Pa4(e.x*f-e.z*d+o.R*t.y,-e.y-o.R*t.z*d+o.R*t.x*f)}function p(e){return e.x*d}function y(e){var t=3.5/o.m;return e.length()/t}function k(e){var t=1/o.m;return o.Dt*((1+o.e)*e)/t}function m(e,t){var n=k(p(e));return y(v(e,t))<=n}function b(e){return .2-.1*Math.atan2(Math.abs(e.y),e.x)}function w(e,t){var n=Math.atan2(-e.x,e.y),i=2.5*t.length()*(e.length()*o.R)/(o.R*o.R),r=t.clone().normalize();return(0,a.a1)(r).applyAxisAngle(r,n).multiplyScalar(i)}},"./src/model/physics/pocket.ts":(e,t,n)=>{n.d(t,{f:()=>u});var i=n("./src/model/ball.ts"),a=n("./node_modules/three/build/three.module.js"),o=n("./src/model/physics/constants.ts"),r=n("./src/utils/utils.ts");function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),l(this,"pos",void 0),l(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"fall",value:function(e,t){return e.vel.z=-o.g*t,e.state=i.Z.Falling,e.pocket=this,e.vel.length()}},{key:"updateFall",value:function(e,t){if(e.vel.addScaledVector(r.up,-(10*o.R)/.5*t*o.g),e.pos.z<-(2*o.R)/.5&&(e.pos.z+=a.M8C.randFloat(-o.R,.25*o.R),e.setStationary(),e.state=i.Z.InPocket),e.pos.distanceTo(this.pos)>this.radius-o.R){var n=this.pos.clone().sub(e.pos).normalize().multiplyScalar(e.vel.length()*o.R);0>e.vel.dot(n)&&(e.vel.x=n.x,e.vel.y=n.y)}}}],t=[{key:"willFall",value:function(e,t){return t.distanceTo(e.pos)<e.radius}},{key:"findPocket",value:function(e,t,i){var a=t.futurePosition(i);return e.find(function(e){return n.willFall(e,a)})}}],e&&s(n.prototype,e),t&&s(n,t),n}()},"./src/model/table.ts":(e,t,n)=>{n.d(t,{i:()=>P});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/physics.ts"),o=n("./node_modules/three/build/three.module.js"),r=n("./src/view/pocketgeometry.ts"),s=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"bounceAny",value:function(e,n){var a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=e.futurePosition(n);if(t.willBounceLong(o,a)){var r=o.y>i.H.tableY?-Math.PI/2:Math.PI/2;return t.bounceIn(r,e)}if(t.willBounceShort(o,a)){var s=o.x>i.H.tableX?0:Math.PI;return t.bounceIn(s,e)}}},{key:"willBounceShort",value:function(e,n){return n?t.willBounceShortSegment(r.u.pockets.pocketNW.knuckleSW.pos.y,r.u.pockets.pocketSW.knuckleNW.pos.y,e):t.willBounceShortSegment(i.H.Y,-i.H.Y,e)}},{key:"willBounceLong",value:function(e,n){return n?t.willBounceLongSegment(r.u.pockets.pocketNW.knuckleNE.pos.x,r.u.pockets.pocketN.knuckleNW.pos.x,e)||t.willBounceLongSegment(r.u.pockets.pocketN.knuckleNE.pos.x,r.u.pockets.pocketNE.knuckleNW.pos.x,e):t.willBounceLongSegment(-i.H.X,i.H.X,e)}},{key:"willBounceLongSegment",value:function(e,t,n){return n.x>e&&n.x<t&&Math.abs(n.y)>i.H.tableY}},{key:"willBounceShortSegment",value:function(e,t,n){return n.y>t&&n.y<e&&Math.abs(n.x)>i.H.tableX}},{key:"bounceIn",value:function(e,t){var n=new o.Pa4,i=new o.Pa4;return(0,a.ZI)(e,t.vel,t.rvel,n,i),t.vel.add(n),t.rvel.add(i),n.length()}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),l=n("./src/model/ball.ts"),u=n("./src/model/physics/constants.ts"),c=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"willCollide",value:function(e,t,n){return(e.inMotion()||t.inMotion())&&e.onTable()&&t.onTable()&&e.futurePosition(n).distanceToSquared(t.futurePosition(n))<4*u.R*u.R}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"updateVelocities",value:function(e,t){var n=t.pos.clone().sub(e.pos).normalize(),i=n.dot(e.vel),a=n.dot(t.vel);return e.vel.addScaledVector(n,a).addScaledVector(n,-i),t.vel.addScaledVector(n,i).addScaledVector(n,-a),e.state=l.Z.Sliding,t.state=l.Z.Sliding,Math.abs(i)+Math.abs(a)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),h=n("./src/model/physics/knuckle.ts"),f=n("./src/model/physics/pocket.ts"),d=n("./src/utils/utils.ts"),v=n("./src/events/aimevent.ts");function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"createHelper",value:function(){var e=new o.fHI(u.R,u.R,30*u.R/.5,12,1,!0),t=new o.Kj0(e,this.helpermaterial);return t.geometry.applyMatrix4(new o.yGw().identity().makeRotationAxis(d.up,-Math.PI/2)).applyMatrix4(new o.yGw().identity().makeTranslation(15*u.R/.5,0,-(.01*u.R)/.5)),t.visible=!1,t.renderOrder=-1,t.material.depthTest=!1,t}},{key:"createPlacer",value:function(){var e=new o.fHI(.01*u.R/.5,u.R,u.R,4),n=new o.Kj0(e,t.helpermaterial);return n.geometry.applyMatrix4(new o.yGw().identity().makeRotationAxis(new o.Pa4(1,0,0),-Math.PI/2)).applyMatrix4(new o.yGw().identity().makeTranslation(0,0,.7*u.R/.5)),n.visible=!1,n}},{key:"createCue",value:function(e,n,i){var a=new o.fHI(e,n,i,11),r=new o.Kj0(a,t.material);return r.castShadow=!1,r.geometry.applyMatrix4(new o.yGw().identity().makeRotationAxis(new o.Pa4(1,0,0),-.1)).applyMatrix4(new o.yGw().identity().makeRotationAxis(d.up,-Math.PI/2)).applyMatrix4(new o.yGw().identity().makeTranslation(-i/2-u.R,0,2*u.R)),r}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}p(y,"material",new o.xoR({color:8934775,wireframe:!1,flatShading:!1})),p(y,"helpermaterial",new o.jyz({uniforms:{lightDirection:{value:new o.Pa4(0,0,1)}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;  \n      void main() {\n        vNormal = normal;\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      uniform vec3 lightDirection;\n      void main() {\n        float intensity = dot(vNormal, lightDirection);\n        vec3 color = vec3(1.0, 1.0, 1.0);\n        vec3 finalColor = color * intensity;\n        gl_FragColor = vec4(finalColor, 0.05 * (1.0-vUv.y));\n      }\n    ",wireframe:!1,transparent:!0}));var b=function(){var e,t;function n(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),m(this,"mesh",void 0),m(this,"helperMesh",void 0),m(this,"placerMesh",void 0),m(this,"offCenterLimit",.3),m(this,"maxPower",120*u.R),m(this,"t",0),m(this,"aimInputs",void 0),m(this,"aim",new v.f),m(this,"length",1*i.H.tableX),this.mesh=y.createCue(.05*u.R/.5,.15*u.R/.5,this.length),this.helperMesh=y.createHelper(),this.placerMesh=y.createPlacer()}return e=[{key:"rotateAim",value:function(e){this.aim.angle+=e,this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle}},{key:"adjustPower",value:function(e){this.aim.power=Math.min(this.maxPower,this.aim.power+e),this.updateAimInput()}},{key:"setPower",value:function(e){this.aim.power=e*this.maxPower}},{key:"hit",value:function(e){var t=this.aim;this.t=0,e.state=l.Z.Sliding,e.vel.copy((0,d.AA)(t.angle).multiplyScalar(t.power)),e.rvel.copy((0,a.WL)(t.offset,e.vel))}},{key:"adjustSpin",value:function(e){var t=this.aim.offset.clone().add(e);this.setSpin(t)}},{key:"setSpin",value:function(e){e.length()>this.offCenterLimit&&e.normalize().multiplyScalar(this.offCenterLimit),this.aim.offset=e,this.updateAimInput()}},{key:"updateAimInput",value:function(){var e,t;null===(e=this.aimInputs)||void 0===e||e.updateVisualState(this.aim.offset.x,this.aim.offset.y),null===(t=this.aimInputs)||void 0===t||t.updatePowerSlider(this.aim.power/this.maxPower)}},{key:"moveTo",value:function(e){this.aim.pos.copy(e),this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle;var t=(0,d.a1)((0,d.AA)(this.aim.angle)).multiplyScalar(2*this.aim.offset.x*u.R).setZ(2*this.aim.offset.y*u.R),n=(Math.sin(this.t+Math.PI/2)-1)*5*u.R*(this.aim.power/this.maxPower),i=(0,d.AA)(this.aim.angle).clone().multiplyScalar(n);this.mesh.position.copy(e.clone().add(t).add(i)),this.helperMesh.position.copy(e),this.placerMesh.position.copy(e),this.placerMesh.rotation.z=this.t}},{key:"update",value:function(e){this.t+=e,this.moveTo(this.aim.pos)}},{key:"placeBallMode",value:function(){this.mesh.visible=!1,this.placerMesh.visible=!0,this.aim.angle=0}},{key:"aimMode",value:function(){this.mesh.visible=!0,this.placerMesh.visible=!1}},{key:"intersectsAnything",value:function(e){var t=e.cueball.pos.clone().addScaledVector((0,d.AA)(this.aim.angle),-this.length/2);t.z=this.aim.offset.y;var n=(0,d.AA)(this.aim.angle);return new o.iMs(t,n,0,this.length/2-.6).intersectObjects(e.balls.map(function(e){return e.ballmesh.mesh})).length>0}},{key:"showHelper",value:function(e){this.helperMesh.visible=e}},{key:"toggleHelper",value:function(){this.showHelper(!this.helperMesh.visible)}}],k(n.prototype,e),t&&k(n,t),n}(),w=n("./src/model/outcome.ts");function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),x(this,"balls",void 0),x(this,"cue",new b),x(this,"pairs",void 0),x(this,"outcome",[]),x(this,"hasPockets",!0),x(this,"cueball",void 0),this.cueball=e[0],this.initialiseBalls(e)}return e=[{key:"initialiseBalls",value:function(e){this.balls=e,this.pairs=[];for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)t<n&&this.pairs.push({a:e[t],b:e[n]})}},{key:"updateBallMesh",value:function(e){this.balls.forEach(function(t){t.updateMesh(e)})}},{key:"advance",value:function(e){for(var t=0;!this.prepareAdvanceAll(e);)if(t++>100)throw Error("Depth exceeded resolving collisions");this.balls.forEach(function(t){t.update(e)})}},{key:"prepareAdvanceAll",value:function(e){var t=this;return this.pairs.every(function(n){return t.prepareAdvancePair(n.a,n.b,e)})&&this.balls.every(function(n){return t.prepareAdvanceToCushions(n,e)})}},{key:"prepareAdvancePair",value:function(e,t,n){if(c.willCollide(e,t,n)){var i=c.collide(e,t);return this.outcome.push(w.k.collision(e,t,i)),!1}return!0}},{key:"prepareAdvanceToCushions",value:function(e,t){if(!e.onTable())return!0;var n=e.futurePosition(t);if(Math.abs(n.y)<i.H.tableY&&Math.abs(n.x)<i.H.tableX)return!0;var a=s.bounceAny(e,t,this.hasPockets);if(a)return this.outcome.push(w.k.cushion(e,a)),!1;if(!this.hasPockets)return!0;var o=h.T.findBouncing(e,t);if(o){var l=o.bounce(e);return this.outcome.push(w.k.cushion(e,l)),!1}var u=f.f.findPocket(r.u.pocketCenters,e,t);if(u){var c=u.fall(e,t);return this.outcome.push(w.k.pot(e,c)),!1}return!0}},{key:"allStationary",value:function(){return this.balls.every(function(e){return!e.inMotion()||!e.onTable()})}},{key:"inPockets",value:function(){return this.balls.reduce(function(e,t){return t.onTable()?e:e+1},0)}},{key:"hit",value:function(){this.cue.hit(this.cueball),this.balls.forEach(function(e){e.ballmesh.trace.reset()})}},{key:"serialise",value:function(){return{balls:this.balls.map(function(e){return e.serialise()}),aim:this.cue.aim.copy()}}},{key:"updateFromSerialised",value:function(e){e.balls&&this.balls.forEach(function(t,n){return l.e.updateFromSerialised(t,e.balls[n])}),e.aim&&(this.cue.aim=v.f.fromJson(e.aim))}},{key:"shortSerialise",value:function(){return this.balls.map(function(e){return[e.pos.x,e.pos.y]}).reduce(function(e,t){return e.concat(t)},[])}},{key:"updateFromShortSerialised",value:function(e){this.balls.forEach(function(t,n){t.pos.x=e[2*n],t.pos.y=e[2*n+1],t.pos.z=0,t.state=l.Z.Stationary})}},{key:"addToScene",value:function(e){this.balls.forEach(function(t){t.ballmesh.addToScene(e)}),e.add(this.cue.mesh),e.add(this.cue.helperMesh),e.add(this.cue.placerMesh)}},{key:"showTraces",value:function(e){this.balls.forEach(function(t){t.ballmesh.trace.line.visible=e,t.ballmesh.trace.reset()})}},{key:"showSpin",value:function(e){this.balls.forEach(function(t){t.ballmesh.spinAxisArrow.visible=e})}}],t=[{key:"fromSerialised",value:function(e){var t=new n(e.balls.map(function(e){return l.e.fromSerialised(e)}));return t.updateFromSerialised(e),t}}],e&&g(n.prototype,e),t&&g(n,t),n}()},"./src/utils/utils.ts":(e,t,n)=>{n.d(t,{AA:()=>h,Bh:()=>r,KO:()=>u,Ls:()=>c,NM:()=>f,a1:()=>s,bM:()=>a,up:()=>o,wK:()=>d});var i=n("./node_modules/three/build/three.module.js"),a=new i.Pa4(0,0,0),o=new i.Pa4(0,0,1);function r(e){return new i.Pa4(e.x,e.y,e.z)}function s(e){return o.clone().cross(e)}var l=new i.Pa4;function u(e){return e.clone(e).normalize()}function c(e,t){return 0>=l.copy(e).add(t).dot(e)}function h(e){return new i.Pa4(1,0,0).applyAxisAngle(o,e)}function f(e){return Math.round((e+Number.EPSILON)*1e3)/1e3}function d(e){return e.x=f(e.x),e.y=f(e.y),e.z=f(e.z),e}},"./src/view/pocketgeometry.ts":(e,t,n)=>{n.d(t,{u:()=>u});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/model/physics/knuckle.ts"),o=n("./src/model/physics/pocket.ts"),r=n("./src/view/tablegeometry.ts"),s=n("./src/model/physics/constants.ts");function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"scaleToRadius",value:function(e){t.PX=r.H.tableX+1.6*e,t.PY=r.H.tableY+1.6*e,t.knuckleInset=1.6*e/.5,t.knuckleRadius=.31*e/.5,t.middleKnuckleInset=1.385*e/.5,t.middleKnuckleRadius=.2*e/.5,t.cornerRadius=1.1*e/.5,t.middleRadius=.9*e/.5,t.pocketLayout(e),t.enumerateCenters(),t.enumerateKnuckles()}},{key:"enumerateKnuckles",value:function(){t.knuckles=[t.pockets.pocketNW.knuckleNE,t.pockets.pocketNW.knuckleSW,t.pockets.pocketN.knuckleNW,t.pockets.pocketN.knuckleNE,t.pockets.pocketS.knuckleSW,t.pockets.pocketS.knuckleSE,t.pockets.pocketNE.knuckleNW,t.pockets.pocketNE.knuckleSE,t.pockets.pocketSE.knuckleNE,t.pockets.pocketSE.knuckleSW,t.pockets.pocketSW.knuckleSE,t.pockets.pocketSW.knuckleNW]}},{key:"enumerateCenters",value:function(){t.pocketCenters=[t.pockets.pocketNW.pocket,t.pockets.pocketSW.pocket,t.pockets.pocketN.pocket,t.pockets.pocketS.pocket,t.pockets.pocketNE.pocket,t.pockets.pocketSE.pocket]}},{key:"pocketLayout",value:function(e){t.pockets={pocketNW:{pocket:new o.f(new i.Pa4(-t.PX,t.PY,0),t.cornerRadius),knuckleNE:new a.T(new i.Pa4(-r.H.X+t.knuckleInset,r.H.Y+t.knuckleRadius,0),t.knuckleRadius),knuckleSW:new a.T(new i.Pa4(-r.H.X-t.knuckleRadius,r.H.Y-t.knuckleInset,0),t.knuckleRadius)},pocketN:{pocket:new o.f(new i.Pa4(0,t.PY+.7*e/.5,0),t.middleRadius),knuckleNE:new a.T(new i.Pa4(t.middleKnuckleInset,r.H.Y+t.middleKnuckleRadius,0),t.middleKnuckleRadius),knuckleNW:new a.T(new i.Pa4(-t.middleKnuckleInset,r.H.Y+t.middleKnuckleRadius,0),t.middleKnuckleRadius)},pocketS:{pocket:new o.f(new i.Pa4(0,-t.PY-.7*e/.5,0),t.middleRadius),knuckleSE:new a.T(new i.Pa4(t.middleKnuckleInset,-r.H.Y-t.middleKnuckleRadius,0),t.middleKnuckleRadius),knuckleSW:new a.T(new i.Pa4(-t.middleKnuckleInset,-r.H.Y-t.middleKnuckleRadius,0),t.middleKnuckleRadius)},pocketNE:{pocket:new o.f(new i.Pa4(t.PX,t.PY,0),t.cornerRadius),knuckleNW:new a.T(new i.Pa4(r.H.X-t.knuckleInset,r.H.Y+t.knuckleRadius,0),t.knuckleRadius),knuckleSE:new a.T(new i.Pa4(r.H.X+t.knuckleRadius,r.H.Y-t.knuckleInset,0),t.knuckleRadius)},pocketSE:{pocket:new o.f(new i.Pa4(t.PX,-t.PY,0),t.cornerRadius),knuckleNE:new a.T(new i.Pa4(r.H.X+t.knuckleRadius,-r.H.Y+t.knuckleInset,0),t.knuckleRadius),knuckleSW:new a.T(new i.Pa4(r.H.X-t.knuckleInset,-r.H.Y-t.knuckleRadius,0),t.knuckleRadius)},pocketSW:{pocket:new o.f(new i.Pa4(-t.PX,-t.PY,0),t.cornerRadius),knuckleSE:new a.T(new i.Pa4(-r.H.X+t.knuckleInset,-r.H.Y-t.knuckleRadius,0),t.knuckleRadius),knuckleNW:new a.T(new i.Pa4(-r.H.X-t.knuckleRadius,-r.H.Y+t.knuckleInset,0),t.knuckleRadius)}}}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();l(u,"PX",void 0),l(u,"PY",void 0),l(u,"knuckleInset",void 0),l(u,"knuckleRadius",void 0),l(u,"middleKnuckleInset",void 0),l(u,"middleKnuckleRadius",void 0),l(u,"cornerRadius",void 0),l(u,"middleRadius",void 0),l(u,"pockets",void 0),l(u,"knuckles",void 0),l(u,"pocketCenters",void 0),u.scaleToRadius(s.R)},"./src/view/sliders.ts":(e,t,n)=>{n.d(t,{E:()=>r});var i=n("./src/model/physics/constants.ts");function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function(){var e,t;function n(e){var t,a;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),o(this,"style",void 0),o(this,"notify",void 0),this.notify=null!=e?e:function(){},this.style=null!==(a=null===(t=document.getElementById("constants"))||void 0===t?void 0:t.style)&&void 0!==a?a:{},this.initialiseSider("R",i.R,i.Ew),this.initialiseSider("m",i.m,i.fN),this.initialiseSider("e",i.e,i.G3),this.initialiseSider("mu",i.mu,i.dE),this.initialiseSider("muS",i.zv,i.f7),this.initialiseSider("muC",i.Dt,i.Xm),this.initialiseSider("rho",i._5,i.zq)}return e=[{key:"toggleVisibility",value:function(){this.style.visibility="visible"===this.style.visibility?"hidden":"visible"}},{key:"getInputElement",value:function(e){var t;return null!==(t=document.getElementById(e))&&void 0!==t?t:{}}},{key:"initialiseSider",value:function(e,t,n){var i=this,a=this.getInputElement(e);a.step="0.001",a.min="0.01",a.max="1.0",a.value=t,this.showValue(e,t),a.oninput=function(t){var a=parseFloat(t.target.value);n(a),i.showValue(e,a),i.notify()}}},{key:"showValue",value:function(e,t){var n=document.querySelector("label[for=".concat(e,"]"));n&&(n.innerHTML="".concat(e,"=").concat(t))}}],a(n.prototype,e),t&&a(n,t),n}()},"./src/view/tablegeometry.ts":(e,t,n)=>{n.d(t,{H:()=>o});var i=n("./src/model/physics/constants.ts");function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"scaleToRadius",value:function(e){t.tableX=43*e,t.tableY=21*e,t.X=t.tableX+e,t.Y=t.tableY+e}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();a(o,"tableX",void 0),a(o,"tableY",void 0),a(o,"X",void 0),a(o,"Y",void 0),o.scaleToRadius(i.R)}},e=>{e(e.s="./src/diagrams.ts")}]);