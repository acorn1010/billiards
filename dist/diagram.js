"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[465],{"./src/diagrams.ts":(e,t,n)=>{var i,a,r,o,s,l,c,u,h,f=n("./src/model/table.ts"),d=n("./src/view/tablegeometry.ts");function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),v(this,"state",void 0),v(this,"control",void 0),this.state=e,this.control=t,this.addControls(t,i)}return e=[{key:"readValue",value:function(e){var t=this.control.querySelector(e);return t?t.valueAsNumber:0}},{key:"readControls",value:function(){var e=this.state.balls[0];e.pos.x=this.readValue("#x"),e.pos.y=this.readValue("#y"),e.vel.x=this.readValue("#vx"),e.vel.y=this.readValue("#vy"),e.rvel.x=this.readValue("#wx"),e.rvel.y=this.readValue("#wy"),e.rvel.z=this.readValue("#wz")}},{key:"addControls",value:function(e,t){var n=this.state.balls[0],i='type="number" step="0.1"';e.innerHTML='\n        x <input id="x" '.concat(i,' value="').concat(n.pos.x,'">\n		  <input id="y" ').concat(i,' value="').concat(n.pos.y,'">\n        ẋ <input id="vx" ').concat(i,' value="').concat(n.vel.x,'">\n		  <input id="vy" ').concat(i,' value="').concat(n.vel.y,'">\n        ω <input id="wx" ').concat(i,' value="').concat(n.rvel.x,'">\n		  <input id="wy" ').concat(i,' value="').concat(n.rvel.y,'">\n          <input id="wz" ').concat(i,' value="').concat(n.rvel.z,'"><button type="button">replay</button>'),e.getElementsByTagName("button")[0].onclick=t}}],p(n.prototype,e),t&&p(n,t),n}();function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){var e,t;function n(e,t,i){var a=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),m(this,"table",void 0),m(this,"diagram",void 0),m(this,"diagramInputs",void 0),m(this,"last",performance.now()),m(this,"step",.001),m(this,"tablecolor","#0a5c5c"),m(this,"colors",["#aaaaaa","#ff0000","#ffff00"]),this.table=f.i.fromSerialised(e),this.diagram=t,this.diagramInputs=new y(e,i,function(){return a.restart()}),this.scale(),this.drawTable(),this.animate(this.last)}return e=[{key:"scale",value:function(){var e=this.diagram.canvas.clientWidth,t=this.diagram.canvas.clientHeight,n=.45*e/d.H.X;this.diagram.setTransform(n,0,0,n,.5*e,.5*t)}},{key:"drawTable",value:function(){var e=d.H.X,t=d.H.Y;this.diagram.fillStyle=this.tablecolor,this.diagram.fillRect(-e,-t,2*e,2*t)}},{key:"drawBall",value:function(e,t,n){this.diagram.fillStyle=n,this.diagram.beginPath(),this.diagram.ellipse(e,t,.5,.5,0,0,2*Math.PI),this.diagram.fill()}},{key:"drawBalls",value:function(){var e=this,t=0;this.table.balls.forEach(function(n){return e.drawBall(n.pos.x,n.pos.y,e.colors[t++])})}},{key:"clearBalls",value:function(){var e=this;this.table.balls.forEach(function(t){return e.drawBall(t.pos.x,t.pos.y,e.tablecolor)})}},{key:"advance",value:function(e){for(var t=Math.floor(e/this.step),n=0;n<t;n++)this.table.advance(this.step)}},{key:"animate",value:function(e){var t=this;this.clearBalls(),this.advance((e-this.last)/1e3),this.last=e,this.drawBalls(),this.table.allStationary()||requestAnimationFrame(function(e){t.animate(e)})}},{key:"restart",value:function(){this.diagramInputs.readControls(),this.table.updateFromSerialised(this.diagramInputs.state),this.drawTable(),this.last=performance.now(),this.animate(this.last)}}],k(n.prototype,e),t&&k(n,t),n}(),w=n("./src/model/physics/physics.ts"),g=n("./node_modules/three/build/three.module.js");function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),P(this,"canvas",void 0),P(this,"context",void 0),P(this,"endx",100),P(this,"endy",100),P(this,"scale",75),P(this,"r",20),P(this,"dv",new g.Pa4),P(this,"dw",new g.Pa4),e.firstElementChild.innerHTML=t,this.canvas=e.lastElementChild,this.context=this.canvas.getContext("2d")}return e=[{key:"drawBall",value:function(){this.context.beginPath(),this.context.strokeStyle="lightgray",this.context.fillStyle="beige",this.context.arc(this.endx,this.endy,this.r,0,2*Math.PI,!1),this.context.fill(),this.context.stroke()}},{key:"drawCushion",value:function(){var e=this.context.createLinearGradient(10,90,200,90);e.addColorStop(0,"lightgray"),e.addColorStop(.75,"white"),this.context.fillStyle=e,this.context.fillRect(this.endx+this.r,10,200,250)}},{key:"plot",value:function(e,t,n,i,a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCushion(),this.drawBall();for(var r=e;r<=t;r+=n){var o=i(r),s=a(r),l=(0,w.vZ)(o,s)?[]:[2,2];this.context.setLineDash(l);var c=(r+360)*101%360;this.context.strokeStyle="hsl(".concat(c,",50%,50%)"),this.drawArrow(this.endx-o.x*this.scale,this.endy-o.y*this.scale,this.endx,this.endy),(0,w.ZI)(0,o,s,this.dv,this.dw),o.add(this.dv),this.drawArrow(this.endx,this.endy,this.endx+o.x*this.scale,this.endy+o.y*this.scale)}}},{key:"drawArrow",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.9,r={dx:n-e,dy:i-t},o={x:r.dx*a+e,y:r.dy*a+t},s={dx:n-o.x,dy:i-o.y};this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(o.x,o.y),this.context.moveTo(o.x+.5*s.dy,o.y-.5*s.dx),this.context.lineTo(o.x-.5*s.dy,o.y+.5*s.dx),this.context.lineTo(n,i),this.context.closePath(),this.context.stroke()}}],x(n.prototype,e),t&&x(n,t),n}(),M=n("./src/model/physics/constants.ts");function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var O=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),T(this,"canvas",void 0),T(this,"ctx",void 0),T(this,"xAxis",void 0),T(this,"yAxis",void 0),T(this,"gutter",20),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvas.previousElementSibling.innerHTML=t,this.canvas.nextElementSibling.innerHTML=i}return e=[{key:"plot",value:function(e,t,n){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.shadowColor="grey",this.ctx.shadowBlur=2,this.xAxis=this.axisInfo(e,this.canvas.width),this.yAxis=this.axisInfo(I(t).concat(I(n)),this.canvas.height),this.drawXAxis(e),this.plotLine(e,t,"blue"),this.plotLine(e,n,"red")}},{key:"plotLine",value:function(e,t,n){this.ctx.beginPath();for(var i=0;i<e.length;i++){var a=this.scale(e[i],this.xAxis),r=this.canvas.height-.8*this.scale(t[i],this.yAxis)-this.gutter;0===i?this.ctx.moveTo(a,r):this.ctx.lineTo(a,r)}this.ctx.strokeStyle=n,this.ctx.stroke()}},{key:"drawXAxis",value:function(e){var t=this.canvas.height-this.gutter;this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.strokeStyle="grey",this.ctx.stroke(),this.ctx.font="8px Arial",this.ctx.strokeStyle="grey";for(var n=!1,i=2;i<e.length-2;i++){var a=this.scale(e[i],this.xAxis);this.ctx.beginPath(),this.ctx.moveTo(a,t),this.ctx.lineTo(a,t+4),this.ctx.stroke(),n||this.ctx.fillText(e[i],a-5,t+10),n=!n}}},{key:"scale",value:function(e,t){return(e-t.min)*t.scale}},{key:"axisInfo",value:function(e,t){var n,i,a=(n=Math).min.apply(n,I(e)),r=(i=Math).max.apply(i,I(e));return{min:a,max:r,scale:t/(r-a||1)}}}],R(n.prototype,e),t&&R(n,t),n}(),C=n("./src/model/ball.ts"),E=n("./src/utils/utils.ts");function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),j(this,"ball",void 0),j(this,"theta",0),j(this,"canvas",void 0),j(this,"ctx",void 0),j(this,"step",.01),this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.ball=new C.e(E.bM),this.ball.vel=new g.Pa4(8.5,0,0),this.ball.rvel=new g.Pa4(0,0*this.ball.vel.x/M.R,0),this.ball.state=C.Z.Sliding}return e=[{key:"drawBall",value:function(e,t,n){var i=this.canvas.width,a=this.canvas.height,r=i/(27*M.R);this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n;var o=e*r+2*M.R*r,s=t*r+a/2,l=M.R*r;this.ctx.ellipse(o,s,l,l,0,0,2*Math.PI),this.ctx.stroke();var c=o+-(M.R*Math.sin(this.theta))*r,u=s+M.R*Math.cos(this.theta)*r;this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(o,s),this.ctx.lineTo(c,u),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="black",this.ctx.arc(c,u,3,0,2*Math.PI),this.ctx.fill()}},{key:"advance",value:function(e){this.ball.update(e);var t=this.ball.rvel.length()*e;this.theta+=t}},{key:"draw",value:function(e){this.ctx.clearRect(0,0,1,1);for(var t=0;t<e;){var n="blue";this.ball.isRolling()?n="red":this.ball.inMotion()&&(n="green"),this.drawBall(this.ball.pos.x,0,n),this.advance(this.step),t+=this.step}}}],N(n.prototype,e),t&&N(n,t),n}(),H=F("rollcanvas");H?new B(H).draw(5):(V("diagram1",[K(0,0,-20,0,0,0,0),K(2,2,-20,0,0,0,20),K(-2,-2,-20,0,0,0,-20)]),V("diagram2",[K(-17,2,0,-40,-85,0,-35),K(-17.38,-2,0,0,0,0,0)]),i=new S(F("cushion1"),"stun shot"),a=new S(F("cushion2"),"running side"),r=new S(F("cushion3"),"check side"),o=new S(F("cushion4"),"varying side"),s=new S(F("cushion5"),"varying side high vel"),l=new O("plot1","Spinning ball played slowly directly into cushion","top/back spin w.y"),c=new O("plot2","Spinning ball played hard directly into cushion","top/back spin w.y"),u=new O("plot3","Right hand spinning ball with varying incident angle","Incident angle (degrees) of ball to cushion with right side"),h=new O("plot4","Cushion friction (mu) varies with incident angle","Incident angle (degrees) of ball to cushion"),Y(),X(),W("R",M.Ew),W("m",M.fN),W("e",M.G3),W("mu",M.dE),W("muS",M.f7),W("muC",M.Xm),W("rho",M.zq),W("s",function(e){z=e}));var z=1;function W(e,t){F(e).oninput=function(n){var i=parseFloat(n.target.value);t(i),document.querySelector("label[for=".concat(e,"]")).innerHTML="".concat(e,"=").concat(i),X(),Y()}}function X(){var e=function(e){return function(t){return new g.Pa4(0,0,e)}},t=function(e){return new g.Pa4(Math.cos(e*Math.PI/180),Math.sin(e*Math.PI/180),0)};i.plot(10,80,10,t,function(e){return new g.Pa4(0,0,0)}),a.plot(10,80,10,t,e(-3)),r.plot(10,80,10,t,e(3)),o.plot(-6,6,1,function(e){return new g.Pa4(.7,.7,0)},function(e){return new g.Pa4(0,0,e)}),s.plot(-6,6,1,function(e){return new g.Pa4(2,2,0)},function(e){return new g.Pa4(0,0,e)})}function Y(){(function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),r=new g.Pa4(0,0,i);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,r)))}l.plot(e,t,n)})(),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),r=new g.Pa4(0,i,0);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,r)))}c.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-80;i<=80;i+=10){e.push(i);var a=i*Math.PI/180,r=new g.Pa4(Math.cos(a),Math.sin(a),0);r.multiplyScalar(z);var o=new g.Pa4(0,0,-10);t.push((0,w.NP)((0,w.c0)(r))),n.push((0,w.al)((0,w.s0)(r,o)))}u.plot(e,t,n)}(),function(){for(var e=[],t=[],n=-80;n<=80;n+=10){e.push(n);var i=n*Math.PI/180,a=new g.Pa4(Math.cos(i),Math.sin(i),0),r=(0,w.GK)(a);t.push(r)}h.plot(e,t,t)}()}function V(e,t){return new b({balls:t},L(e,"canvas").getContext("2d"),L(e,"control"))}function K(e,t,n,i,a,r,o){return{pos:{x:e,y:t,z:0},vel:{x:n,y:i,z:0},rvel:{x:a,y:r,z:o},state:"Sliding"}}function F(e){return document.getElementById(e)}function L(e,t){var n="#"+e+" #"+t,i=document.querySelector(n);if(null==i)throw Error("Element not found "+n);return i}},"./src/events/aimevent.ts":(e,t,n)=>{n.d(t,{f:()=>f});var i=n("./src/events/gameevent.ts"),a=n("./src/events/eventtype.ts"),r=n("./src/utils/utils.ts"),o=n("./node_modules/three/build/three.module.js");function s(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(d,e);var t,n,i,f=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n,i=u(d);if(t){var a=u(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return(e=n)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:s(this)});function d(){var e;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d),c(s(e=f.call(this)),"verticalOffset",0),c(s(e),"sideOffset",0),c(s(e),"angle",0),c(s(e),"power",0),c(s(e),"pos",new o.Pa4(0,0,0)),e.type=a.t.AIM,e}return n=[{key:"applyToController",value:function(e){return e.handleAim(this)}},{key:"copy",value:function(){return d.fromJson(this)}},{key:"round",value:function(){this.angle=(0,r.NM)(this.angle),this.power=(0,r.NM)(this.power),this.verticalOffset=(0,r.NM)(this.verticalOffset),this.sideOffset=(0,r.NM)(this.sideOffset)}}],i=[{key:"fromJson",value:function(e){var t=new d;return t.pos=(0,r.Bh)(e.pos),t.angle=e.angle,t.verticalOffset=e.verticalOffset,t.sideOffset=e.sideOffset,t.power=e.power,t}}],n&&l(d.prototype,n),i&&l(d,i),d}(i.Z)},"./src/events/eventtype.ts":(e,t,n)=>{var i;n.d(t,{t:()=>i}),function(e){e.BEGIN="BEGIN",e.BREAK="BREAK",e.WATCHAIM="WATCHAIM",e.AIM="AIM",e.HIT="HIT",e.STATIONARY="STATIONARY",e.CHAT="CHAT",e.ABORT="ABORT",e.PLACEBALL="PLACEBALL"}(i||(i={}))},"./src/events/gameevent.ts":(e,t,n)=>{n.d(t,{Z:()=>i});var i=function e(){var t,n;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),n=void 0,(t="type")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}},"./src/model/ball.ts":(e,t,n)=>{n.d(t,{e:()=>d,Z:()=>i});var i,a=n("./node_modules/three/build/three.module.js"),r=n("./src/utils/utils.ts"),o=n("./src/model/physics/physics.ts"),s=n("./src/model/physics/constants.ts");function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),c(this,"mesh",void 0),c(this,"shadow",void 0),c(this,"spinAxisArrow",void 0),c(this,"m",new a.yGw),this.initialiseMesh(e)}return e=[{key:"updatePosition",value:function(e){this.mesh.position.copy(e),this.shadow.position.copy(e)}},{key:"updateRotation",value:function(e,t){var n=e.length()*t*2*s.R,i=this.m.identity().makeRotationAxis((0,r.KO)(e),n);this.mesh.geometry.applyMatrix4(i)}},{key:"updateArrows",value:function(e,t,n){this.spinAxisArrow.setLength(.4+t.length()/2,.1,.1),this.spinAxisArrow.position.copy(e),this.spinAxisArrow.setDirection((0,r.KO)(t)),n==i.Rolling?this.spinAxisArrow.setColor(16711680):this.spinAxisArrow.setColor(65280)}},{key:"initialiseMesh",value:function(e){var t=new a.cJO(.5,1),n=new a.xoR({emissive:0,flatShading:!0,vertexColors:!0});this.addDots(t,e),this.mesh=new a.Kj0(t,n),this.mesh.name="ball",this.updateRotation(new a.Pa4().random(),1);var i=new a.zf8(.45,9);i.applyMatrix4(new a.yGw().identity().makeTranslation(0,0,-.49));var o=new a.vBJ({color:1118498});this.shadow=new a.Kj0(i,o),this.spinAxisArrow=new a.tGC(r.up,r.bM,2,0),this.spinAxisArrow.visible=!1}},{key:"addDots",value:function(e,t){var n=this,i=e.attributes.position.count,r=new a.Ilk(t),o=new a.Ilk(11149858);e.setAttribute("color",new a.TlE(new Float32Array(3*i),3));for(var s=e.attributes.color,l=0;l<i/3;l++)this.colorVerticesForFace(l,s,r.r,r.g,r.b);[0,96,111,156,186,195].forEach(function(e){n.colorVerticesForFace(e/3,s,o.r,o.g,o.b)})}},{key:"colorVerticesForFace",value:function(e,t,n,i,a){t.setXYZ(3*e+0,n,i,a),t.setXYZ(3*e+1,n,i,a),t.setXYZ(3*e+2,n,i,a)}}],l(n.prototype,e),t&&l(n,t),n}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Stationary="Stationary",e.Rolling="Rolling",e.Sliding="Sliding",e.Falling="Falling",e.InPocket="InPocket"}(i||(i={}));var d=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),f(this,"pos",void 0),f(this,"vel",r.bM.clone()),f(this,"rvel",r.bM.clone()),f(this,"state",i.Stationary),f(this,"pocket",void 0),f(this,"futurePos",r.bM.clone()),f(this,"ballmesh",void 0),f(this,"transition",.05),f(this,"dv",new a.Pa4),f(this,"dw",new a.Pa4),this.pos=e.clone(),this.ballmesh=new u(t||5592405*Math.random())}return e=[{key:"update",value:function(e){this.updatePosition(e),this.updateVelocity(e),this.state==i.Falling&&this.updateFalling(e)}},{key:"updateMesh",value:function(e){this.ballmesh.updatePosition(this.pos),this.ballmesh.updateArrows(this.pos,this.rvel,this.state),0!==this.rvel.lengthSq()&&this.ballmesh.updateRotation(this.rvel,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e)}},{key:"updateFalling",value:function(e){if(this.vel.addScaledVector(r.up,-10*e*s.g),this.pos.z<-2&&(this.pos.z+=a.M8C.randFloat(-.5,.25),this.setStationary(),this.state=i.InPocket),this.pos.distanceTo(this.pocket.pos)>this.pocket.radius-.5){var t=this.pocket.pos.clone().sub(this.pos).normalize().multiplyScalar(.5*this.vel.length());0>this.vel.dot(t)&&(this.vel.x=t.x,this.vel.y=t.y)}}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?this.updateVelocityRolling(e):this.updateVelocitySliding(e))}},{key:"updateVelocityRolling",value:function(e){(0,o.QC)(this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,r.Ls)(this.rvel,this.dw)||(0,r.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=i.Rolling)}},{key:"updateVelocitySliding",value:function(e){(0,o.Vp)(this.vel,this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,r.Ls)(this.rvel,this.dw)&&(0,r.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=i.Sliding)}},{key:"setStationary",value:function(){this.vel.copy(r.bM),this.rvel.copy(r.bM),this.state=i.Stationary}},{key:"isRolling",value:function(){return 0!=this.vel.lengthSq()&&0!=this.rvel.lengthSq()&&(0,o.E9)(this.vel,this.rvel).length()<this.transition}},{key:"onTable",value:function(){return this.state!==i.Falling&&this.state!==i.InPocket}},{key:"inMotion",value:function(){return this.state==i.Rolling||this.state==i.Sliding}},{key:"isFalling",value:function(){return this.state==i.Falling}},{key:"futurePosition",value:function(e){return this.futurePos.copy(this.pos).addScaledVector(this.vel,e),this.futurePos}},{key:"serialise",value:function(){return{pos:this.pos,vel:this.vel,rvel:this.rvel,state:this.state}}}],t=[{key:"fromSerialised",value:function(e){return n.updateFromSerialised(new n((0,r.Bh)(e.pos)),e)}},{key:"updateFromSerialised",value:function(e,t){return e.pos.copy(t.pos),e.vel.copy((0,r.Bh)(t.vel)),e.rvel.copy((0,r.Bh)(t.rvel)),e.state=t.state,e}}],e&&h(n.prototype,e),t&&h(n,t),n}()},"./src/model/outcome.ts":(e,t,n)=>{function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{k:()=>r}),function(e){e.Pot="Pot",e.Cushion="Cushion",e.Collision="Collision",e.Hit="Hit"}(a||(a={}));var a,r=function(){var e;function t(e,n,a,r){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),i(this,"type",void 0),i(this,"timestamp",void 0),i(this,"ballA",null),i(this,"ballB",null),i(this,"incidentSpeed",void 0),this.type=e,this.ballA=n,this.ballB=a,this.incidentSpeed=r,this.timestamp=Date.now()}return e=[{key:"pot",value:function(e,n){return new t(a.Pot,e,e,n)}},{key:"cushion",value:function(e,n){return new t(a.Cushion,e,e,n)}},{key:"collision",value:function(e,n,i){return new t(a.Collision,e,n,i)}},{key:"hit",value:function(e,n){return new t(a.Hit,e,e,n)}},{key:"isCueBallPotted",value:function(e,t){return t.some(function(t){return t.type==a.Pot&&t.ballA===e})}},{key:"isBallPottedNoFoul",value:function(e,n){return n.some(function(e){return e.type==a.Pot&&null!==e.ballA})&&!t.isCueBallPotted(e,n)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}()},"./src/model/physics/constants.ts":(e,t,n)=>{n.d(t,{Dt:()=>c,Ew:()=>v,G3:()=>w,Hz:()=>a,I:()=>r,Mz:()=>i,R:()=>f,Xm:()=>g,_5:()=>u,dE:()=>k,e:()=>d,f7:()=>b,fN:()=>y,g:()=>o,m:()=>h,mu:()=>s,zq:()=>m,zv:()=>l});var i,a,r,o=9.8,s=.29,l=.89,c=.4,u=.4,h=.2,f=.5,d=.85;function p(){i=s*h*o*2/3*u,a=7/(5*Math.sqrt(2))*f*s*h*o,r=.4*h*f*f}function v(e){f=e,p()}function y(e){h=e,p()}function k(e){s=e,p()}function m(e){u=e,p()}function b(e){l=e}function w(e){d=e}function g(e){c=e}p()},"./src/model/physics/knuckle.ts":(e,t,n)=>{n.d(t,{T:()=>s});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/constants.ts");function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),o(this,"pos",void 0),o(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"bounce",value:function(e){var t=e.pos.clone().sub(this.pos).normalize(),n=t.dot(e.vel);return e.vel.addScaledVector(t,-2*a.e*n),Math.abs(n)}}],t=[{key:"willBounce",value:function(e,t){return t.distanceTo(e.pos)<.5+e.radius}},{key:"findBouncing",value:function(e,t){var a=e.futurePosition(t);return i.H.knuckles.find(function(e){return n.willBounce(e,a)})}}],e&&r(n.prototype,e),t&&r(n,t),n}()},"./src/model/physics/physics.ts":(e,t,n)=>{n.d(t,{E9:()=>o,GK:()=>m,NP:()=>y,QC:()=>l,Vp:()=>s,WL:()=>b,ZI:()=>c,al:()=>v,c0:()=>p,s0:()=>d,vZ:()=>k});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/utils/utils.ts"),r=n("./src/model/physics/constants.ts");function o(e,t){return e.clone().addScaledVector((0,a.a1)(t),r.R)}function s(e,t,n,i){var s=o(e,t).setZ(0);n.copy((0,a.KO)(s).multiplyScalar(-r.zv*r.g)),i.copy((0,a.KO)((0,a.a1)(s)).multiplyScalar(2.5*r.zv*r.g/r.R)),i.setZ(-2.5*(r.Mz/(r.R*r.R))*Math.sign(t.z))}function l(e,t,n){var a=new i.Pa4(e.x,e.y,0).length(),o=5/7*r.Hz/(r.m*r.R)/a,s=5/7*r.Hz/(r.m*r.R*r.R)/a;t.set(-o*e.y,o*e.x,0),n.set(-s*e.x,-s*e.y,-2.5*(r.Mz/(r.m*r.R*r.R))*Math.sign(e.z))}function c(e,t,n,i,o){(function(e,t,n,i){var a,o,s=p(e),l=d(e,t),c=y(s),u=v(l),k=3.5/r.m,b=1/r.m,w=(1+r.e)*(s/b),g=0;if(u<c)a=-l.x/k*h-w*f,o=l.y/k,g=l.x/k*f-w*h;else{var x=m(e),P=Math.abs(Math.atan2(e.y,e.x)),S=Math.cos(P);a=-x*w*S*f-w*f,o=x*w*Math.sin(P),g=x*w*S*f-w*h}n.x=a/r.m,n.y=o/r.m,i.x=-r.R/r.I*o*h,i.y=r.R/r.I*(a*h-g*f),i.z=r.R/r.I*o*f})(t.clone().applyAxisAngle(a.up,e),n.clone().applyAxisAngle(a.up,e),i,o),i.applyAxisAngle(a.up,-e),o.applyAxisAngle(a.up,-e)}var u=Math.asin(.2*r.R/r.R),h=Math.sin(u),f=Math.cos(u);function d(e,t){return new i.Pa4(e.x*h-e.z*f+r.R*t.y,-e.y-r.R*t.z*f+r.R*t.x*h)}function p(e){return e.x*f}function v(e){var t=3.5/r.m;return e.length()/t}function y(e){var t=1/r.m;return r.Dt*((1+r.e)*e)/t}function k(e,t){var n=y(p(e));return v(d(e,t))<=n}function m(e){return .2-.1*Math.atan2(Math.abs(e.y),e.x)}function b(e,t){var n=Math.atan2(-e.x,e.y),i=2.5*t.length()*(e.length()*r.R)/(r.R*r.R),o=t.clone().normalize();return(0,a.a1)(o).applyAxisAngle(o,n).multiplyScalar(i)}},"./src/model/physics/pocket.ts":(e,t,n)=>{n.d(t,{f:()=>l});var i=n("./src/model/ball.ts"),a=n("./src/view/tablegeometry.ts"),r=n("./src/model/physics/constants.ts");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),s(this,"pos",void 0),s(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"fall",value:function(e,t){return e.vel.z=-r.g*t,e.state=i.Z.Falling,e.pocket=this,e.vel.length()}}],t=[{key:"willFall",value:function(e,t){return t.distanceTo(e.pos)<e.radius}},{key:"findPocket",value:function(e,t){var i=e.futurePosition(t);return a.H.pocketCenters.find(function(e){return n.willFall(e,i)})}}],e&&o(n.prototype,e),t&&o(n,t),n}()},"./src/model/table.ts":(e,t,n)=>{n.d(t,{i:()=>g});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/physics.ts"),r=n("./node_modules/three/build/three.module.js"),o=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"bounceAny",value:function(e,n){var a=e.futurePosition(n);if(t.willBounceLongSegment(i.H.pockets.pocketNW.knuckleNE.pos.x,i.H.pockets.pocketN.knuckleNW.pos.x,a)||t.willBounceLongSegment(i.H.pockets.pocketN.knuckleNE.pos.x,i.H.pockets.pocketNE.knuckleNW.pos.x,a)){var r=a.y>i.H.tableY?-Math.PI/2:Math.PI/2;return t.bounceIn(r,e)}if(t.willBounceShortSegment(i.H.pockets.pocketNW.knuckleSW.pos.y,i.H.pockets.pocketSW.knuckleNW.pos.y,a)){var o=a.x>i.H.tableX?0:Math.PI;return t.bounceIn(o,e)}}},{key:"willBounceLongSegment",value:function(e,t,n){return n.x>e&&n.x<t&&Math.abs(n.y)>i.H.tableY}},{key:"willBounceShortSegment",value:function(e,t,n){return n.y>t&&n.y<e&&Math.abs(n.x)>i.H.tableX}},{key:"bounceIn",value:function(e,t){var n=new r.Pa4,i=new r.Pa4;return(0,a.ZI)(e,t.vel,t.rvel,n,i),t.vel.add(n),t.rvel.add(i),n.length()}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),s=n("./src/model/ball.ts"),l=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"willCollide",value:function(e,t,n){return(e.inMotion()||t.inMotion())&&e.onTable()&&t.onTable()&&1>e.futurePosition(n).distanceToSquared(t.futurePosition(n))}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"updateVelocities",value:function(e,t){var n=t.pos.clone().sub(e.pos).normalize(),i=n.dot(e.vel),a=n.dot(t.vel);return e.vel.addScaledVector(n,a).addScaledVector(n,-i),t.vel.addScaledVector(n,i).addScaledVector(n,-a),e.state=s.Z.Sliding,t.state=s.Z.Sliding,Math.abs(i)+Math.abs(a)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),c=n("./src/model/physics/knuckle.ts"),u=n("./src/model/physics/pocket.ts"),h=n("./src/utils/utils.ts"),f=n("./src/events/aimevent.ts");function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"createHelper",value:function(){var e=new r.fHI(.5,.5,30,12,1,!0),t=new r.Kj0(e,this.helpermaterial);return t.geometry.applyMatrix4(new r.yGw().identity().makeRotationAxis(h.up,-Math.PI/2)).applyMatrix4(new r.yGw().identity().makeTranslation(15,0,-.01)),t.visible=!1,t.renderOrder=-1,t.material.depthTest=!1,t}},{key:"createPlacer",value:function(){var e=new r.fHI(.01,.5,.5,4),n=new r.Kj0(e,t.helpermaterial);return n.geometry.applyMatrix4(new r.yGw().identity().makeRotationAxis(new r.Pa4(1,0,0),-Math.PI/2)).applyMatrix4(new r.yGw().identity().makeTranslation(0,0,.7)),n.visible=!1,n}},{key:"createCue",value:function(e,n,i){var a=new r.fHI(e,n,i,11),o=new r.Kj0(a,t.material);return o.castShadow=!1,o.geometry.applyMatrix4(new r.yGw().identity().makeRotationAxis(new r.Pa4(1,0,0),-.1)).applyMatrix4(new r.yGw().identity().makeRotationAxis(h.up,-Math.PI/2)).applyMatrix4(new r.yGw().identity().makeTranslation(-i/2-.5,0,1)),o}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}d(p,"material",new r.xoR({color:8934775,wireframe:!1,flatShading:!1})),d(p,"helpermaterial",new r.jyz({uniforms:{lightDirection:{value:new r.Pa4(0,0,1)}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;  \n      void main() {\n        vNormal = normal;\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      uniform vec3 lightDirection;\n      void main() {\n        float intensity = dot(vNormal, lightDirection);\n        vec3 color = vec3(1.0, 1.0, 1.0);\n        vec3 finalColor = color * intensity;\n        gl_FragColor = vec4(finalColor, 0.05 * (1.0-vUv.y));\n      }\n    ",wireframe:!1,transparent:!0}));var k=function(){var e,t;function n(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),y(this,"mesh",void 0),y(this,"helperMesh",void 0),y(this,"placerMesh",void 0),y(this,"limit",.5),y(this,"maxPower",60),y(this,"t",0),y(this,"aimInputs",void 0),y(this,"aim",new f.f),y(this,"length",1*i.H.tableX),this.mesh=p.createCue(.05,.15,this.length),this.helperMesh=p.createHelper(),this.placerMesh=p.createPlacer()}return e=[{key:"rotateAim",value:function(e){this.aim.angle+=e,this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle}},{key:"adjustHeight",value:function(e){this.aim.verticalOffset=r.M8C.clamp(this.aim.verticalOffset+e,-this.limit,this.limit),this.mesh.position.z=this.aim.verticalOffset,this.updateAimInput()}},{key:"adjustSide",value:function(e){this.aim.sideOffset=r.M8C.clamp(this.aim.sideOffset+e,-this.limit,this.limit),this.updateAimInput()}},{key:"adjustPower",value:function(e){this.aim.power=Math.min(this.maxPower,this.aim.power+e),this.updateAimInput()}},{key:"setPower",value:function(e){this.aim.power=e*this.maxPower}},{key:"hit",value:function(e){var t=this.aim;e.state=s.Z.Sliding,e.vel.copy((0,h.AA)(t.angle).multiplyScalar(t.power));var n=new r.Pa4(t.sideOffset,t.verticalOffset,0);e.rvel.copy((0,a.WL)(n,e.vel))}},{key:"setSpin",value:function(e,t){var n=new r.Pa4(e,t);n.length()>.26&&n.normalize().multiplyScalar(.25),this.aim.verticalOffset=n.y,this.aim.sideOffset=n.x,this.updateAimInput()}},{key:"updateAimInput",value:function(){var e,t;null===(e=this.aimInputs)||void 0===e||e.updateVisualState(this.aim.sideOffset,this.aim.verticalOffset),null===(t=this.aimInputs)||void 0===t||t.updatePowerSlider(this.aim.power/this.maxPower)}},{key:"moveTo",value:function(e){this.aim.pos.copy(e),this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle;var t=(0,h.a1)((0,h.AA)(this.aim.angle)).multiplyScalar(this.aim.sideOffset).setZ(this.aim.verticalOffset),n=(Math.sin(this.t/3)-1)*.25,i=(0,h.AA)(this.aim.angle).clone().multiplyScalar(n-this.aim.power/this.maxPower*3);this.mesh.position.copy(e.clone().add(t).add(i)),this.helperMesh.position.copy(e),this.placerMesh.position.copy(e),this.placerMesh.rotation.z=this.t}},{key:"update",value:function(e){this.t+=e,this.moveTo(this.aim.pos)}},{key:"placeBallMode",value:function(){this.mesh.visible=!1,this.placerMesh.visible=!0}},{key:"aimMode",value:function(){this.mesh.visible=!0,this.placerMesh.visible=!1}},{key:"intersectsAnything",value:function(e){var t=e.balls[0].pos.clone().addScaledVector((0,h.AA)(this.aim.angle),-this.length/2);t.z=this.aim.verticalOffset;var n=(0,h.AA)(this.aim.angle);return new r.iMs(t,n,0,this.length/2-.6).intersectObjects(e.balls.map(function(e){return e.ballmesh.mesh})).length>0}},{key:"showHelper",value:function(e){this.helperMesh.visible=e}},{key:"toggleHelper",value:function(){this.showHelper(!this.helperMesh.visible)}}],v(n.prototype,e),t&&v(n,t),n}(),m=n("./src/model/outcome.ts");function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),w(this,"balls",void 0),w(this,"cue",new k),w(this,"pairs",void 0),w(this,"outcome",[]),this.initialiseBalls(e)}return e=[{key:"initialiseBalls",value:function(e){this.balls=e,this.pairs=[];for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)t<n&&this.pairs.push({a:e[t],b:e[n]})}},{key:"updateBallMesh",value:function(e){this.balls.forEach(function(t){t.updateMesh(e)})}},{key:"advance",value:function(e){for(var t=0;!this.prepareAdvanceAll(e);)if(t++>100)throw Error("Depth exceeded resolving collisions");this.balls.forEach(function(t){t.update(e)})}},{key:"prepareAdvanceAll",value:function(e){var t=this;return this.pairs.every(function(n){return t.prepareAdvancePair(n.a,n.b,e)})&&this.balls.every(function(n){return t.prepareAdvanceToCushions(n,e)})}},{key:"prepareAdvancePair",value:function(e,t,n){if(l.willCollide(e,t,n)){var i=l.collide(e,t);return this.outcome.push(m.k.collision(e,t,i)),!1}return!0}},{key:"prepareAdvanceToCushions",value:function(e,t){if(!e.onTable())return!0;var n=e.futurePosition(t);if(Math.abs(n.y)<i.H.tableY&&Math.abs(n.x)<i.H.tableX)return!0;var a=o.bounceAny(e,t);if(a)return this.outcome.push(m.k.cushion(e,a)),!1;var r=c.T.findBouncing(e,t);if(r){var s=r.bounce(e);return this.outcome.push(m.k.cushion(e,s)),!1}var l=u.f.findPocket(e,t);if(l){var h=l.fall(e,t);return this.outcome.push(m.k.pot(e,h)),!1}return!0}},{key:"allStationary",value:function(){return this.balls.every(function(e){return!e.inMotion()||!e.onTable()})}},{key:"hit",value:function(){this.cue.hit(this.balls[0])}},{key:"serialise",value:function(){return{balls:this.balls.map(function(e){return e.serialise()}),aim:this.cue.aim.copy()}}},{key:"updateFromSerialised",value:function(e){e.balls&&this.balls.forEach(function(t,n){return s.e.updateFromSerialised(t,e.balls[n])}),e.aim&&(this.cue.aim=f.f.fromJson(e.aim))}},{key:"shortSerialise",value:function(){return this.balls.map(function(e){return[e.pos.x,e.pos.y]}).reduce(function(e,t){return e.concat(t)},[])}},{key:"updateFromShortSerialised",value:function(e){this.balls.forEach(function(t,n){t.pos.x=e[2*n],t.pos.y=e[2*n+1]})}}],t=[{key:"fromSerialised",value:function(e){var t=new n(e.balls.map(function(e){return s.e.fromSerialised(e)}));return t.updateFromSerialised(e),t}}],e&&b(n.prototype,e),t&&b(n,t),n}()},"./src/utils/utils.ts":(e,t,n)=>{n.d(t,{AA:()=>u,Bh:()=>o,KO:()=>l,Ls:()=>c,NM:()=>h,a1:()=>s,bM:()=>a,up:()=>r,wK:()=>f});var i=n("./node_modules/three/build/three.module.js"),a=new i.Pa4(0,0,0),r=new i.Pa4(0,0,1);function o(e){return new i.Pa4(e.x,e.y,e.z)}function s(e){return r.clone().cross(e)}function l(e){return e.clone().normalize()}function c(e,t){return 0>=e.clone().add(t).dot(e)}function u(e){return new i.Pa4(1,0,0).applyAxisAngle(r,e)}function h(e){return Math.round((e+Number.EPSILON)*1e3)/1e3}function f(e){return e.x=h(e.x),e.y=h(e.y),e.z=h(e.z),e}},"./src/view/tablegeometry.ts":(e,t,n)=>{n.d(t,{H:()=>s});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/model/physics/knuckle.ts"),r=n("./src/model/physics/pocket.ts");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"addToScene",value:function(e){t.knuckles.forEach(function(n){return t.knuckleCylinder(n,e)}),t.pocketCenters.forEach(function(n){return t.knuckleCylinder(n,e)})}},{key:"knuckleCylinder",value:function(e,n){t.cylinder(e.pos,e.radius,.75,n).position.setZ(-.125)}},{key:"cylinder",value:function(e,n,a,r){var o=new i.fHI(n,n,a,16),s=new i.Kj0(o,t.material);return s.position.copy(e),s.geometry.applyMatrix4(new i.yGw().identity().makeRotationAxis(new i.Pa4(1,0,0),Math.PI/2)),r.add(s),s}},{key:"addCushions",value:function(e){t.plane(new i.Pa4(0,0,-5.5),2*t.X,2*t.Y,10,e);var n=Math.abs(t.pockets.pocketNW.knuckleNE.pos.x-t.pockets.pocketN.knuckleNW.pos.x),a=Math.abs(t.pockets.pocketNW.knuckleSW.pos.y-t.pockets.pocketSW.knuckleNW.pos.y);t.plane(new i.Pa4(t.X+.5,0,-.125),1,a,.75,e),t.plane(new i.Pa4(-t.X-.5,0,-.125),1,a,.75,e),t.plane(new i.Pa4(-t.X/2,t.Y+.5,-.125),n,1,.75,e),t.plane(new i.Pa4(-t.X/2,-t.Y-.5,-.125),n,1,.75,e),t.plane(new i.Pa4(t.X/2,t.Y+.5,-.125),n,1,.75,e),t.plane(new i.Pa4(t.X/2,-t.Y-.5,-.125),n,1,.75,e)}},{key:"plane",value:function(e,n,a,r,o){var s=new i.DvJ(n,a,r),l=new i.Kj0(s,t.material);l.receiveShadow=!0,l.position.copy(e),o.add(l)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();o(s,"tableX",21.5),o(s,"tableY",10.5),o(s,"X",s.tableX+.5),o(s,"Y",s.tableY+.5),o(s,"PX",s.tableX+.8),o(s,"PY",s.tableY+.8),o(s,"knuckleInset",1.6),o(s,"knuckleRadius",.31),o(s,"middleKnuckleInset",1.385),o(s,"middleKnuckleRadius",.2),o(s,"cornerRadius",1.1),o(s,"middleRadius",.9),o(s,"pockets",{pocketNW:{pocket:new r.f(new i.Pa4(-s.PX,s.PY,0),s.cornerRadius),knuckleNE:new a.T(new i.Pa4(-s.X+s.knuckleInset,s.Y+s.knuckleRadius,0),s.knuckleRadius),knuckleSW:new a.T(new i.Pa4(-s.X-s.knuckleRadius,s.Y-s.knuckleInset,0),s.knuckleRadius)},pocketN:{pocket:new r.f(new i.Pa4(0,s.PY+.7,0),s.middleRadius),knuckleNE:new a.T(new i.Pa4(s.middleKnuckleInset,s.Y+s.middleKnuckleRadius,0),s.middleKnuckleRadius),knuckleNW:new a.T(new i.Pa4(-s.middleKnuckleInset,s.Y+s.middleKnuckleRadius,0),s.middleKnuckleRadius)},pocketS:{pocket:new r.f(new i.Pa4(0,-s.PY-.7,0),s.middleRadius),knuckleSE:new a.T(new i.Pa4(s.middleKnuckleInset,-s.Y-s.middleKnuckleRadius,0),s.middleKnuckleRadius),knuckleSW:new a.T(new i.Pa4(-s.middleKnuckleInset,-s.Y-s.middleKnuckleRadius,0),s.middleKnuckleRadius)},pocketNE:{pocket:new r.f(new i.Pa4(s.PX,s.PY,0),s.cornerRadius),knuckleNW:new a.T(new i.Pa4(s.X-s.knuckleInset,s.Y+s.knuckleRadius,0),s.knuckleRadius),knuckleSE:new a.T(new i.Pa4(s.X+s.knuckleRadius,s.Y-s.knuckleInset,0),s.knuckleRadius)},pocketSE:{pocket:new r.f(new i.Pa4(s.PX,-s.PY,0),s.cornerRadius),knuckleNE:new a.T(new i.Pa4(s.X+s.knuckleRadius,-s.Y+s.knuckleInset,0),s.knuckleRadius),knuckleSW:new a.T(new i.Pa4(s.X-s.knuckleInset,-s.Y-s.knuckleRadius,0),s.knuckleRadius)},pocketSW:{pocket:new r.f(new i.Pa4(-s.PX,-s.PY,0),s.cornerRadius),knuckleSE:new a.T(new i.Pa4(-s.X+s.knuckleInset,-s.Y-s.knuckleRadius,0),s.knuckleRadius),knuckleNW:new a.T(new i.Pa4(-s.X-s.knuckleRadius,-s.Y+s.knuckleInset,0),s.knuckleRadius)}}),o(s,"knuckles",[s.pockets.pocketNW.knuckleNE,s.pockets.pocketNW.knuckleSW,s.pockets.pocketN.knuckleNW,s.pockets.pocketN.knuckleNE,s.pockets.pocketS.knuckleSW,s.pockets.pocketS.knuckleSE,s.pockets.pocketNE.knuckleNW,s.pockets.pocketNE.knuckleSE,s.pockets.pocketSE.knuckleNE,s.pockets.pocketSE.knuckleSW,s.pockets.pocketSW.knuckleSE,s.pockets.pocketSW.knuckleNW]),o(s,"pocketCenters",[s.pockets.pocketNW.pocket,s.pockets.pocketSW.pocket,s.pockets.pocketN.pocket,s.pockets.pocketS.pocket,s.pockets.pocketNE.pocket,s.pockets.pocketSE.pocket]),o(s,"material",new i.xoR({color:4478361,wireframe:!1,flatShading:!0,transparent:!0,opacity:.4}))}},e=>{e(e.s="./src/diagrams.ts")}]);