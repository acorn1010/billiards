"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[465],{"./src/diagrams.ts":(e,t,n)=>{var i,a,s,r,o,l,c,u,h,f=n("./src/model/table.ts"),d=n("./src/view/tablegeometry.ts");function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),p(this,"state",void 0),p(this,"control",void 0),this.state=e,this.control=t,this.addControls(t,i)}return e=[{key:"readValue",value:function(e){var t=this.control.querySelector(e);return t?t.valueAsNumber:0}},{key:"readControls",value:function(){var e=this.state.balls[0];e.pos.x=this.readValue("#x"),e.pos.y=this.readValue("#y"),e.vel.x=this.readValue("#vx"),e.vel.y=this.readValue("#vy"),e.rvel.x=this.readValue("#wx"),e.rvel.y=this.readValue("#wy"),e.rvel.z=this.readValue("#wz")}},{key:"addControls",value:function(e,t){var n=this.state.balls[0],i='type="number" step="0.1"';e.innerHTML='\n        x <input id="x" '.concat(i,' value="').concat(n.pos.x,'">\n		  <input id="y" ').concat(i,' value="').concat(n.pos.y,'">\n        ẋ <input id="vx" ').concat(i,' value="').concat(n.vel.x,'">\n		  <input id="vy" ').concat(i,' value="').concat(n.vel.y,'">\n        ω <input id="wx" ').concat(i,' value="').concat(n.rvel.x,'">\n		  <input id="wy" ').concat(i,' value="').concat(n.rvel.y,'">\n          <input id="wz" ').concat(i,' value="').concat(n.rvel.z,'"><button type="button">replay</button>'),e.getElementsByTagName("button")[0].onclick=t}}],v(n.prototype,e),t&&v(n,t),n}();function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){var e,t;function n(e,t,i){var a=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),m(this,"table",void 0),m(this,"diagram",void 0),m(this,"diagramInputs",void 0),m(this,"last",performance.now()),m(this,"step",.001),m(this,"tablecolor","#0a5c5c"),m(this,"colors",["#aaaaaa","#ff0000","#ffff00"]),this.table=f.i.fromSerialised(e),this.diagram=t,this.diagramInputs=new y(e,i,function(){return a.restart()}),this.scale(),this.drawTable(),this.animate(this.last)}return e=[{key:"scale",value:function(){var e=this.diagram.canvas.clientWidth,t=this.diagram.canvas.clientHeight,n=.45*e/d.H.X;this.diagram.setTransform(n,0,0,n,.5*e,.5*t)}},{key:"drawTable",value:function(){var e=d.H.X,t=d.H.Y;this.diagram.fillStyle=this.tablecolor,this.diagram.fillRect(-e,-t,2*e,2*t)}},{key:"drawBall",value:function(e,t,n){this.diagram.fillStyle=n,this.diagram.beginPath(),this.diagram.ellipse(e,t,.5,.5,0,0,2*Math.PI),this.diagram.fill()}},{key:"drawBalls",value:function(){var e=this,t=0;this.table.balls.forEach(function(n){return e.drawBall(n.pos.x,n.pos.y,e.colors[t++])})}},{key:"clearBalls",value:function(){var e=this;this.table.balls.forEach(function(t){return e.drawBall(t.pos.x,t.pos.y,e.tablecolor)})}},{key:"advance",value:function(e){for(var t=Math.floor(e/this.step),n=0;n<t;n++)this.table.advance(this.step)}},{key:"animate",value:function(e){var t=this;this.clearBalls(),this.advance((e-this.last)/1e3),this.last=e,this.drawBalls(),this.table.allStationary()||requestAnimationFrame(function(e){t.animate(e)})}},{key:"restart",value:function(){this.diagramInputs.readControls(),this.table.updateFromSerialised(this.diagramInputs.state),this.drawTable(),this.last=performance.now(),this.animate(this.last)}}],k(n.prototype,e),t&&k(n,t),n}(),w=n("./src/model/physics/physics.ts"),g=n("./node_modules/three/build/three.module.js");function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),P(this,"canvas",void 0),P(this,"context",void 0),P(this,"endx",100),P(this,"endy",100),P(this,"scale",75),P(this,"r",20),P(this,"dv",new g.Pa4),P(this,"dw",new g.Pa4),e.firstElementChild.innerHTML=t,this.canvas=e.lastElementChild,this.context=this.canvas.getContext("2d")}return e=[{key:"drawBall",value:function(){this.context.beginPath(),this.context.strokeStyle="lightgray",this.context.fillStyle="beige",this.context.arc(this.endx,this.endy,this.r,0,2*Math.PI,!1),this.context.fill(),this.context.stroke()}},{key:"drawCushion",value:function(){var e=this.context.createLinearGradient(10,90,200,90);e.addColorStop(0,"lightgray"),e.addColorStop(.75,"white"),this.context.fillStyle=e,this.context.fillRect(this.endx+this.r,10,200,250)}},{key:"plot",value:function(e,t,n,i,a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCushion(),this.drawBall();for(var s=e;s<=t;s+=n){var r=i(s),o=a(s),l=(0,w.vZ)(r,o)?[]:[2,2];this.context.setLineDash(l);var c=(s+360)*101%360;this.context.strokeStyle="hsl(".concat(c,",50%,50%)"),this.drawArrow(this.endx-r.x*this.scale,this.endy-r.y*this.scale,this.endx,this.endy),(0,w.ZI)(0,r,o,this.dv,this.dw),r.add(this.dv),this.drawArrow(this.endx,this.endy,this.endx+r.x*this.scale,this.endy+r.y*this.scale)}}},{key:"drawArrow",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.9,s={dx:n-e,dy:i-t},r={x:s.dx*a+e,y:s.dy*a+t},o={dx:n-r.x,dy:i-r.y};this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(r.x,r.y),this.context.moveTo(r.x+.5*o.dy,r.y-.5*o.dx),this.context.lineTo(r.x-.5*o.dy,r.y+.5*o.dx),this.context.lineTo(n,i),this.context.closePath(),this.context.stroke()}}],x(n.prototype,e),t&&x(n,t),n}();function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function A(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var I=function(){var e,t;function n(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),R(this,"canvas",void 0),R(this,"ctx",void 0),R(this,"xAxis",void 0),R(this,"yAxis",void 0),R(this,"gutter",20),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvas.previousElementSibling.innerHTML=t,this.canvas.nextElementSibling.innerHTML=i}return e=[{key:"plot",value:function(e,t,n){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.shadowColor="grey",this.ctx.shadowBlur=2,this.xAxis=this.axisInfo(e,this.canvas.width),this.yAxis=this.axisInfo(T(t).concat(T(n)),this.canvas.height),this.drawXAxis(e),this.plotLine(e,t,"blue"),this.plotLine(e,n,"red")}},{key:"plotLine",value:function(e,t,n){this.ctx.beginPath();for(var i=0;i<e.length;i++){var a=this.scale(e[i],this.xAxis),s=this.canvas.height-.8*this.scale(t[i],this.yAxis)-this.gutter;0===i?this.ctx.moveTo(a,s):this.ctx.lineTo(a,s)}this.ctx.strokeStyle=n,this.ctx.stroke()}},{key:"drawXAxis",value:function(e){var t=this.canvas.height-this.gutter;this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.strokeStyle="grey",this.ctx.stroke(),this.ctx.font="8px Arial",this.ctx.strokeStyle="grey";for(var n=!1,i=2;i<e.length-2;i++){var a=this.scale(e[i],this.xAxis);this.ctx.beginPath(),this.ctx.moveTo(a,t),this.ctx.lineTo(a,t+4),this.ctx.stroke(),n||this.ctx.fillText(e[i],a-5,t+10),n=!n}}},{key:"scale",value:function(e,t){return(e-t.min)*t.scale}},{key:"axisInfo",value:function(e,t){var n,i,a=(n=Math).min.apply(n,T(e)),s=(i=Math).max.apply(i,T(e));return{min:a,max:s,scale:t/(s-a||1)}}}],A(n.prototype,e),t&&A(n,t),n}(),E=n("./src/model/ball.ts"),O=n("./src/model/physics/constants.ts"),C=n("./src/utils/utils.ts");function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),N(this,"ball",void 0),N(this,"theta",0),N(this,"canvas",void 0),N(this,"ctx",void 0),N(this,"step",.01),this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.ball=new E.e(C.bM),this.ball.vel=new g.Pa4(8.5,0,0),this.ball.rvel=new g.Pa4(0,0*this.ball.vel.x/O.R,0),this.ball.state=E.Z.Sliding}return e=[{key:"drawBall",value:function(e,t,n){var i=this.canvas.width,a=this.canvas.height,s=i/(27*O.R);this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n;var r=e*s+2*O.R*s,o=t*s+a/2,l=O.R*s;this.ctx.ellipse(r,o,l,l,0,0,2*Math.PI),this.ctx.stroke();var c=r+-(O.R*Math.sin(this.theta))*s,u=o+O.R*Math.cos(this.theta)*s;this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(r,o),this.ctx.lineTo(c,u),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="black",this.ctx.arc(c,u,3,0,2*Math.PI),this.ctx.fill()}},{key:"advance",value:function(e){this.ball.update(e);var t=this.ball.rvel.length()*e;this.theta+=t}},{key:"draw",value:function(e){this.ctx.clearRect(0,0,1,1);for(var t=0;t<e;){var n="blue";this.ball.isRolling()?n="red":this.ball.inMotion()&&(n="green"),this.drawBall(this.ball.pos.x,0,n),this.advance(this.step),t+=this.step}}}],j(n.prototype,e),t&&j(n,t),n}(),H=n("./src/view/sliders.ts"),z=1,W=K("rollcanvas");function V(){var e,t;e=function(e){return function(t){return new g.Pa4(0,0,e)}},t=function(e){return new g.Pa4(Math.cos(e*Math.PI/180),Math.sin(e*Math.PI/180),0)},i.plot(10,80,10,t,function(e){return new g.Pa4(0,0,0)}),a.plot(10,80,10,t,e(-3)),s.plot(10,80,10,t,e(3)),r.plot(-6,6,1,function(e){return new g.Pa4(.7,.7,0)},function(e){return new g.Pa4(0,0,e)}),o.plot(-6,6,1,function(e){return new g.Pa4(2,2,0)},function(e){return new g.Pa4(0,0,e)}),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),s=new g.Pa4(0,0,i);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,s)))}l.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new g.Pa4(1,0,0),s=new g.Pa4(0,i,0);t.push((0,w.NP)((0,w.c0)(a))),n.push((0,w.al)((0,w.s0)(a,s)))}c.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-80;i<=80;i+=10){e.push(i);var a=i*Math.PI/180,s=new g.Pa4(Math.cos(a),Math.sin(a),0);s.multiplyScalar(z);var r=new g.Pa4(0,0,-10);t.push((0,w.NP)((0,w.c0)(s))),n.push((0,w.al)((0,w.s0)(s,r)))}u.plot(e,t,n)}(),function(){for(var e=[],t=[],n=-80;n<=80;n+=10){e.push(n);var i=n*Math.PI/180,a=new g.Pa4(Math.cos(i),Math.sin(i),0),s=(0,w.GK)(a);t.push(s)}h.plot(e,t,t)}()}function X(e,t){return new b({balls:t},F(e,"canvas").getContext("2d"),F(e,"control"))}function Y(e,t,n,i,a,s,r){return{pos:{x:e,y:t,z:0},vel:{x:n,y:i,z:0},rvel:{x:a,y:s,z:r},state:"Sliding"}}function K(e){return document.getElementById(e)}function F(e,t){var n="#"+e+" #"+t,i=document.querySelector(n);if(null==i)throw Error("Element not found "+n);return i}W?new B(W).draw(5):(X("diagram1",[Y(0,0,-20,0,0,0,0),Y(2,2,-20,0,0,0,20),Y(-2,-2,-20,0,0,0,-20)]),X("diagram2",[Y(-17,2,0,-40,-85,0,-35),Y(-17.38,-2,0,0,0,0,0)]),i=new S(K("cushion1"),"stun shot"),a=new S(K("cushion2"),"running side"),s=new S(K("cushion3"),"check side"),r=new S(K("cushion4"),"varying side"),o=new S(K("cushion5"),"varying side high vel"),l=new I("plot1","Spinning ball played slowly directly into cushion","top/back spin w.y"),c=new I("plot2","Spinning ball played hard directly into cushion","top/back spin w.y"),u=new I("plot3","Right hand spinning ball with varying incident angle","Incident angle (degrees) of ball to cushion with right side"),h=new I("plot4","Cushion friction (mu) varies with incident angle","Incident angle (degrees) of ball to cushion"),V(),new H.E(V).initialiseSider("s",z,function(e){z=e}))},"./src/events/aimevent.ts":(e,t,n)=>{n.d(t,{f:()=>f});var i=n("./src/events/gameevent.ts"),a=n("./src/events/eventtype.ts"),s=n("./src/utils/utils.ts"),r=n("./node_modules/three/build/three.module.js");function o(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(d,e);var t,n,i,f=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n,i=u(d);if(t){var a=u(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return(e=n)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:o(this)});function d(){var e;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d),c(o(e=f.call(this)),"verticalOffset",0),c(o(e),"sideOffset",0),c(o(e),"angle",0),c(o(e),"power",0),c(o(e),"pos",new r.Pa4(0,0,0)),e.type=a.t.AIM,e}return n=[{key:"applyToController",value:function(e){return e.handleAim(this)}},{key:"copy",value:function(){return d.fromJson(this)}},{key:"round",value:function(){this.angle=(0,s.NM)(this.angle),this.power=(0,s.NM)(this.power),this.verticalOffset=(0,s.NM)(this.verticalOffset),this.sideOffset=(0,s.NM)(this.sideOffset)}}],i=[{key:"fromJson",value:function(e){var t=new d;return t.pos=(0,s.Bh)(e.pos),t.angle=e.angle,t.verticalOffset=e.verticalOffset,t.sideOffset=e.sideOffset,t.power=e.power,t}}],n&&l(d.prototype,n),i&&l(d,i),d}(i.Z)},"./src/events/eventtype.ts":(e,t,n)=>{var i;n.d(t,{t:()=>i}),function(e){e.BEGIN="BEGIN",e.BREAK="BREAK",e.WATCHAIM="WATCHAIM",e.AIM="AIM",e.HIT="HIT",e.STATIONARY="STATIONARY",e.CHAT="CHAT",e.ABORT="ABORT",e.PLACEBALL="PLACEBALL"}(i||(i={}))},"./src/events/gameevent.ts":(e,t,n)=>{n.d(t,{Z:()=>i});var i=function e(){var t,n;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),n=void 0,(t="type")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}},"./src/model/ball.ts":(e,t,n)=>{n.d(t,{e:()=>d,Z:()=>i});var i,a=n("./node_modules/three/build/three.module.js"),s=n("./src/utils/utils.ts"),r=n("./src/model/physics/physics.ts"),o=n("./src/model/physics/constants.ts");function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),c(this,"mesh",void 0),c(this,"shadow",void 0),c(this,"spinAxisArrow",void 0),c(this,"m",new a.yGw),this.initialiseMesh(e)}return e=[{key:"updatePosition",value:function(e){this.mesh.position.copy(e),this.shadow.position.copy(e)}},{key:"updateRotation",value:function(e,t){var n=e.length()*t*2*o.R,i=this.m.identity().makeRotationAxis((0,s.KO)(e),n);this.mesh.geometry.applyMatrix4(i)}},{key:"updateArrows",value:function(e,t,n){this.spinAxisArrow.setLength(.4+t.length()/2,.1,.1),this.spinAxisArrow.position.copy(e),this.spinAxisArrow.setDirection((0,s.KO)(t)),n==i.Rolling?this.spinAxisArrow.setColor(16711680):this.spinAxisArrow.setColor(65280)}},{key:"initialiseMesh",value:function(e){var t=new a.cJO(.5,1),n=new a.xoR({emissive:0,flatShading:!0,vertexColors:!0});this.addDots(t,e),this.mesh=new a.Kj0(t,n),this.mesh.name="ball",this.updateRotation(new a.Pa4().random(),1);var i=new a.zf8(.45,9);i.applyMatrix4(new a.yGw().identity().makeTranslation(0,0,-.49));var r=new a.vBJ({color:1118498});this.shadow=new a.Kj0(i,r),this.spinAxisArrow=new a.tGC(s.up,s.bM,2,0),this.spinAxisArrow.visible=!1}},{key:"addDots",value:function(e,t){var n=this,i=e.attributes.position.count,s=new a.Ilk(t),r=new a.Ilk(11149858);e.setAttribute("color",new a.TlE(new Float32Array(3*i),3));for(var o=e.attributes.color,l=0;l<i/3;l++)this.colorVerticesForFace(l,o,s.r,s.g,s.b);[0,96,111,156,186,195].forEach(function(e){n.colorVerticesForFace(e/3,o,r.r,r.g,r.b)})}},{key:"colorVerticesForFace",value:function(e,t,n,i,a){t.setXYZ(3*e+0,n,i,a),t.setXYZ(3*e+1,n,i,a),t.setXYZ(3*e+2,n,i,a)}}],l(n.prototype,e),t&&l(n,t),n}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Stationary="Stationary",e.Rolling="Rolling",e.Sliding="Sliding",e.Falling="Falling",e.InPocket="InPocket"}(i||(i={}));var d=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),f(this,"pos",void 0),f(this,"vel",s.bM.clone()),f(this,"rvel",s.bM.clone()),f(this,"state",i.Stationary),f(this,"pocket",void 0),f(this,"futurePos",s.bM.clone()),f(this,"ballmesh",void 0),f(this,"transition",.05),f(this,"dv",new a.Pa4),f(this,"dw",new a.Pa4),this.pos=e.clone(),this.ballmesh=new u(t||5592405*Math.random())}return e=[{key:"update",value:function(e){this.updatePosition(e),this.updateVelocity(e),this.state==i.Falling&&this.updateFalling(e)}},{key:"updateMesh",value:function(e){this.ballmesh.updatePosition(this.pos),this.ballmesh.updateArrows(this.pos,this.rvel,this.state),0!==this.rvel.lengthSq()&&this.ballmesh.updateRotation(this.rvel,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e)}},{key:"updateFalling",value:function(e){if(this.vel.addScaledVector(s.up,-10*e*o.g),this.pos.z<-2&&(this.pos.z+=a.M8C.randFloat(-.5,.25),this.setStationary(),this.state=i.InPocket),this.pos.distanceTo(this.pocket.pos)>this.pocket.radius-.5){var t=this.pocket.pos.clone().sub(this.pos).normalize().multiplyScalar(.5*this.vel.length());0>this.vel.dot(t)&&(this.vel.x=t.x,this.vel.y=t.y)}}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?this.updateVelocityRolling(e):this.updateVelocitySliding(e))}},{key:"updateVelocityRolling",value:function(e){(0,r.QC)(this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,s.Ls)(this.rvel,this.dw)||(0,s.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=i.Rolling)}},{key:"updateVelocitySliding",value:function(e){(0,r.Vp)(this.vel,this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,s.Ls)(this.rvel,this.dw)&&(0,s.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=i.Sliding)}},{key:"setStationary",value:function(){this.vel.copy(s.bM),this.rvel.copy(s.bM),this.state=i.Stationary}},{key:"isRolling",value:function(){return 0!=this.vel.lengthSq()&&0!=this.rvel.lengthSq()&&(0,r.E9)(this.vel,this.rvel).length()<this.transition}},{key:"onTable",value:function(){return this.state!==i.Falling&&this.state!==i.InPocket}},{key:"inMotion",value:function(){return this.state==i.Rolling||this.state==i.Sliding}},{key:"isFalling",value:function(){return this.state==i.Falling}},{key:"futurePosition",value:function(e){return this.futurePos.copy(this.pos).addScaledVector(this.vel,e),this.futurePos}},{key:"serialise",value:function(){return{pos:this.pos,vel:this.vel,rvel:this.rvel,state:this.state}}}],t=[{key:"fromSerialised",value:function(e){return n.updateFromSerialised(new n((0,s.Bh)(e.pos)),e)}},{key:"updateFromSerialised",value:function(e,t){return e.pos.copy(t.pos),e.vel.copy((0,s.Bh)(t.vel)),e.rvel.copy((0,s.Bh)(t.rvel)),e.state=t.state,e}}],e&&h(n.prototype,e),t&&h(n,t),n}()},"./src/model/outcome.ts":(e,t,n)=>{function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{k:()=>s}),function(e){e.Pot="Pot",e.Cushion="Cushion",e.Collision="Collision",e.Hit="Hit"}(a||(a={}));var a,s=function(){var e;function t(e,n,a,s){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),i(this,"type",void 0),i(this,"timestamp",void 0),i(this,"ballA",null),i(this,"ballB",null),i(this,"incidentSpeed",void 0),this.type=e,this.ballA=n,this.ballB=a,this.incidentSpeed=s,this.timestamp=Date.now()}return e=[{key:"pot",value:function(e,n){return new t(a.Pot,e,e,n)}},{key:"cushion",value:function(e,n){return new t(a.Cushion,e,e,n)}},{key:"collision",value:function(e,n,i){return new t(a.Collision,e,n,i)}},{key:"hit",value:function(e,n){return new t(a.Hit,e,e,n)}},{key:"isCueBallPotted",value:function(e,t){return t.some(function(t){return t.type==a.Pot&&t.ballA===e})}},{key:"isBallPottedNoFoul",value:function(e,n){return n.some(function(e){return e.type==a.Pot&&null!==e.ballA})&&!t.isCueBallPotted(e,n)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}()},"./src/model/physics/constants.ts":(e,t,n)=>{n.d(t,{Dt:()=>c,Ew:()=>p,G3:()=>w,Hz:()=>a,I:()=>s,Mz:()=>i,R:()=>f,Xm:()=>g,_5:()=>u,dE:()=>k,e:()=>d,f7:()=>b,fN:()=>y,g:()=>r,m:()=>h,mu:()=>o,zq:()=>m,zv:()=>l});var i,a,s,r=9.8,o=.29,l=.89,c=.4,u=.4,h=.2,f=.5,d=.85;function v(){i=o*h*r*2/3*u,a=7/(5*Math.sqrt(2))*f*o*h*r,s=.4*h*f*f}function p(e){f=e,v()}function y(e){h=e,v()}function k(e){o=e,v()}function m(e){u=e,v()}function b(e){l=e}function w(e){d=e}function g(e){c=e}v()},"./src/model/physics/knuckle.ts":(e,t,n)=>{n.d(t,{T:()=>o});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/constants.ts");function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),r(this,"pos",void 0),r(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"bounce",value:function(e){var t=e.pos.clone().sub(this.pos).normalize(),n=t.dot(e.vel);return e.vel.addScaledVector(t,-2*a.e*n),Math.abs(n)}}],t=[{key:"willBounce",value:function(e,t){return t.distanceTo(e.pos)<.5+e.radius}},{key:"findBouncing",value:function(e,t){var a=e.futurePosition(t);return i.H.knuckles.find(function(e){return n.willBounce(e,a)})}}],e&&s(n.prototype,e),t&&s(n,t),n}()},"./src/model/physics/physics.ts":(e,t,n)=>{n.d(t,{E9:()=>r,GK:()=>m,NP:()=>y,QC:()=>l,Vp:()=>o,WL:()=>b,ZI:()=>c,al:()=>p,c0:()=>v,s0:()=>d,vZ:()=>k});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/utils/utils.ts"),s=n("./src/model/physics/constants.ts");function r(e,t){return e.clone().addScaledVector((0,a.a1)(t),s.R)}function o(e,t,n,i){var o=r(e,t).setZ(0);n.copy((0,a.KO)(o).multiplyScalar(-s.zv*s.g)),i.copy((0,a.KO)((0,a.a1)(o)).multiplyScalar(2.5*s.zv*s.g/s.R)),i.setZ(-2.5*(s.Mz/(s.R*s.R))*Math.sign(t.z))}function l(e,t,n){var a=new i.Pa4(e.x,e.y,0).length(),r=5/7*s.Hz/(s.m*s.R)/a,o=5/7*s.Hz/(s.m*s.R*s.R)/a;t.set(-r*e.y,r*e.x,0),n.set(-o*e.x,-o*e.y,-2.5*(s.Mz/(s.m*s.R*s.R))*Math.sign(e.z))}function c(e,t,n,i,r){(function(e,t,n,i){var a,r,o=v(e),l=d(e,t),c=y(o),u=p(l),k=3.5/s.m,b=1/s.m,w=(1+s.e)*(o/b),g=0;if(u<c)a=-l.x/k*h-w*f,r=l.y/k,g=l.x/k*f-w*h;else{var x=m(e),P=Math.abs(Math.atan2(e.y,e.x)),S=Math.cos(P);a=-x*w*S*f-w*f,r=x*w*Math.sin(P),g=x*w*S*f-w*h}n.x=a/s.m,n.y=r/s.m,i.x=-s.R/s.I*r*h,i.y=s.R/s.I*(a*h-g*f),i.z=s.R/s.I*r*f})(t.clone().applyAxisAngle(a.up,e),n.clone().applyAxisAngle(a.up,e),i,r),i.applyAxisAngle(a.up,-e),r.applyAxisAngle(a.up,-e)}var u=Math.asin(.2*s.R/s.R),h=Math.sin(u),f=Math.cos(u);function d(e,t){return new i.Pa4(e.x*h-e.z*f+s.R*t.y,-e.y-s.R*t.z*f+s.R*t.x*h)}function v(e){return e.x*f}function p(e){var t=3.5/s.m;return e.length()/t}function y(e){var t=1/s.m;return s.Dt*((1+s.e)*e)/t}function k(e,t){var n=y(v(e));return p(d(e,t))<=n}function m(e){return .2-.1*Math.atan2(Math.abs(e.y),e.x)}function b(e,t){var n=Math.atan2(-e.x,e.y),i=2.5*t.length()*(e.length()*s.R)/(s.R*s.R),r=t.clone().normalize();return(0,a.a1)(r).applyAxisAngle(r,n).multiplyScalar(i)}},"./src/model/physics/pocket.ts":(e,t,n)=>{n.d(t,{f:()=>l});var i=n("./src/model/ball.ts"),a=n("./src/view/tablegeometry.ts"),s=n("./src/model/physics/constants.ts");function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e,t;function n(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),o(this,"pos",void 0),o(this,"radius",void 0),this.pos=e,this.radius=t}return e=[{key:"fall",value:function(e,t){return e.vel.z=-s.g*t,e.state=i.Z.Falling,e.pocket=this,e.vel.length()}}],t=[{key:"willFall",value:function(e,t){return t.distanceTo(e.pos)<e.radius}},{key:"findPocket",value:function(e,t){var i=e.futurePosition(t);return a.H.pocketCenters.find(function(e){return n.willFall(e,i)})}}],e&&r(n.prototype,e),t&&r(n,t),n}()},"./src/model/table.ts":(e,t,n)=>{n.d(t,{i:()=>g});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/physics.ts"),s=n("./node_modules/three/build/three.module.js"),r=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"bounceAny",value:function(e,n){var a=e.futurePosition(n);if(t.willBounceLongSegment(i.H.pockets.pocketNW.knuckleNE.pos.x,i.H.pockets.pocketN.knuckleNW.pos.x,a)||t.willBounceLongSegment(i.H.pockets.pocketN.knuckleNE.pos.x,i.H.pockets.pocketNE.knuckleNW.pos.x,a)){var s=a.y>i.H.tableY?-Math.PI/2:Math.PI/2;return t.bounceIn(s,e)}if(t.willBounceShortSegment(i.H.pockets.pocketNW.knuckleSW.pos.y,i.H.pockets.pocketSW.knuckleNW.pos.y,a)){var r=a.x>i.H.tableX?0:Math.PI;return t.bounceIn(r,e)}}},{key:"willBounceLongSegment",value:function(e,t,n){return n.x>e&&n.x<t&&Math.abs(n.y)>i.H.tableY}},{key:"willBounceShortSegment",value:function(e,t,n){return n.y>t&&n.y<e&&Math.abs(n.x)>i.H.tableX}},{key:"bounceIn",value:function(e,t){var n=new s.Pa4,i=new s.Pa4;return(0,a.ZI)(e,t.vel,t.rvel,n,i),t.vel.add(n),t.rvel.add(i),n.length()}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),o=n("./src/model/ball.ts"),l=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"willCollide",value:function(e,t,n){return(e.inMotion()||t.inMotion())&&e.onTable()&&t.onTable()&&1>e.futurePosition(n).distanceToSquared(t.futurePosition(n))}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"updateVelocities",value:function(e,t){var n=t.pos.clone().sub(e.pos).normalize(),i=n.dot(e.vel),a=n.dot(t.vel);return e.vel.addScaledVector(n,a).addScaledVector(n,-i),t.vel.addScaledVector(n,i).addScaledVector(n,-a),e.state=o.Z.Sliding,t.state=o.Z.Sliding,Math.abs(i)+Math.abs(a)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}(),c=n("./src/model/physics/knuckle.ts"),u=n("./src/model/physics/pocket.ts"),h=n("./src/utils/utils.ts"),f=n("./src/events/aimevent.ts");function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"createHelper",value:function(){var e=new s.fHI(.5,.5,30,12,1,!0),t=new s.Kj0(e,this.helpermaterial);return t.geometry.applyMatrix4(new s.yGw().identity().makeRotationAxis(h.up,-Math.PI/2)).applyMatrix4(new s.yGw().identity().makeTranslation(15,0,-.01)),t.visible=!1,t.renderOrder=-1,t.material.depthTest=!1,t}},{key:"createPlacer",value:function(){var e=new s.fHI(.01,.5,.5,4),n=new s.Kj0(e,t.helpermaterial);return n.geometry.applyMatrix4(new s.yGw().identity().makeRotationAxis(new s.Pa4(1,0,0),-Math.PI/2)).applyMatrix4(new s.yGw().identity().makeTranslation(0,0,.7)),n.visible=!1,n}},{key:"createCue",value:function(e,n,i){var a=new s.fHI(e,n,i,11),r=new s.Kj0(a,t.material);return r.castShadow=!1,r.geometry.applyMatrix4(new s.yGw().identity().makeRotationAxis(new s.Pa4(1,0,0),-.1)).applyMatrix4(new s.yGw().identity().makeRotationAxis(h.up,-Math.PI/2)).applyMatrix4(new s.yGw().identity().makeTranslation(-i/2-.5,0,1)),r}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}d(v,"material",new s.xoR({color:8934775,wireframe:!1,flatShading:!1})),d(v,"helpermaterial",new s.jyz({uniforms:{lightDirection:{value:new s.Pa4(0,0,1)}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;  \n      void main() {\n        vNormal = normal;\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      uniform vec3 lightDirection;\n      void main() {\n        float intensity = dot(vNormal, lightDirection);\n        vec3 color = vec3(1.0, 1.0, 1.0);\n        vec3 finalColor = color * intensity;\n        gl_FragColor = vec4(finalColor, 0.05 * (1.0-vUv.y));\n      }\n    ",wireframe:!1,transparent:!0}));var k=function(){var e,t;function n(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),y(this,"mesh",void 0),y(this,"helperMesh",void 0),y(this,"placerMesh",void 0),y(this,"limit",.5),y(this,"maxPower",60),y(this,"t",0),y(this,"aimInputs",void 0),y(this,"aim",new f.f),y(this,"length",1*i.H.tableX),this.mesh=v.createCue(.05,.15,this.length),this.helperMesh=v.createHelper(),this.placerMesh=v.createPlacer()}return e=[{key:"rotateAim",value:function(e){this.aim.angle+=e,this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle}},{key:"adjustHeight",value:function(e){this.aim.verticalOffset=s.M8C.clamp(this.aim.verticalOffset+e,-this.limit,this.limit),this.mesh.position.z=this.aim.verticalOffset,this.updateAimInput()}},{key:"adjustSide",value:function(e){this.aim.sideOffset=s.M8C.clamp(this.aim.sideOffset+e,-this.limit,this.limit),this.updateAimInput()}},{key:"adjustPower",value:function(e){this.aim.power=Math.min(this.maxPower,this.aim.power+e),this.updateAimInput()}},{key:"setPower",value:function(e){this.aim.power=e*this.maxPower}},{key:"hit",value:function(e){var t=this.aim;e.state=o.Z.Sliding,e.vel.copy((0,h.AA)(t.angle).multiplyScalar(t.power));var n=new s.Pa4(t.sideOffset,t.verticalOffset,0);e.rvel.copy((0,a.WL)(n,e.vel))}},{key:"setSpin",value:function(e,t){var n=new s.Pa4(e,t);n.length()>.26&&n.normalize().multiplyScalar(.25),this.aim.verticalOffset=n.y,this.aim.sideOffset=n.x,this.updateAimInput()}},{key:"updateAimInput",value:function(){var e,t;null===(e=this.aimInputs)||void 0===e||e.updateVisualState(this.aim.sideOffset,this.aim.verticalOffset),null===(t=this.aimInputs)||void 0===t||t.updatePowerSlider(this.aim.power/this.maxPower)}},{key:"moveTo",value:function(e){this.aim.pos.copy(e),this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle;var t=(0,h.a1)((0,h.AA)(this.aim.angle)).multiplyScalar(this.aim.sideOffset).setZ(this.aim.verticalOffset),n=(Math.sin(this.t/3)-1)*.25,i=(0,h.AA)(this.aim.angle).clone().multiplyScalar(n-this.aim.power/this.maxPower*3);this.mesh.position.copy(e.clone().add(t).add(i)),this.helperMesh.position.copy(e),this.placerMesh.position.copy(e),this.placerMesh.rotation.z=this.t}},{key:"update",value:function(e){this.t+=e,this.moveTo(this.aim.pos)}},{key:"placeBallMode",value:function(){this.mesh.visible=!1,this.placerMesh.visible=!0}},{key:"aimMode",value:function(){this.mesh.visible=!0,this.placerMesh.visible=!1}},{key:"intersectsAnything",value:function(e){var t=e.balls[0].pos.clone().addScaledVector((0,h.AA)(this.aim.angle),-this.length/2);t.z=this.aim.verticalOffset;var n=(0,h.AA)(this.aim.angle);return new s.iMs(t,n,0,this.length/2-.6).intersectObjects(e.balls.map(function(e){return e.ballmesh.mesh})).length>0}},{key:"showHelper",value:function(e){this.helperMesh.visible=e}},{key:"toggleHelper",value:function(){this.showHelper(!this.helperMesh.visible)}}],p(n.prototype,e),t&&p(n,t),n}(),m=n("./src/model/outcome.ts");function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),w(this,"balls",void 0),w(this,"cue",new k),w(this,"pairs",void 0),w(this,"outcome",[]),this.initialiseBalls(e)}return e=[{key:"initialiseBalls",value:function(e){this.balls=e,this.pairs=[];for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)t<n&&this.pairs.push({a:e[t],b:e[n]})}},{key:"updateBallMesh",value:function(e){this.balls.forEach(function(t){t.updateMesh(e)})}},{key:"advance",value:function(e){for(var t=0;!this.prepareAdvanceAll(e);)if(t++>100)throw Error("Depth exceeded resolving collisions");this.balls.forEach(function(t){t.update(e)})}},{key:"prepareAdvanceAll",value:function(e){var t=this;return this.pairs.every(function(n){return t.prepareAdvancePair(n.a,n.b,e)})&&this.balls.every(function(n){return t.prepareAdvanceToCushions(n,e)})}},{key:"prepareAdvancePair",value:function(e,t,n){if(l.willCollide(e,t,n)){var i=l.collide(e,t);return this.outcome.push(m.k.collision(e,t,i)),!1}return!0}},{key:"prepareAdvanceToCushions",value:function(e,t){if(!e.onTable())return!0;var n=e.futurePosition(t);if(Math.abs(n.y)<i.H.tableY&&Math.abs(n.x)<i.H.tableX)return!0;var a=r.bounceAny(e,t);if(a)return this.outcome.push(m.k.cushion(e,a)),!1;var s=c.T.findBouncing(e,t);if(s){var o=s.bounce(e);return this.outcome.push(m.k.cushion(e,o)),!1}var l=u.f.findPocket(e,t);if(l){var h=l.fall(e,t);return this.outcome.push(m.k.pot(e,h)),!1}return!0}},{key:"allStationary",value:function(){return this.balls.every(function(e){return!e.inMotion()||!e.onTable()})}},{key:"hit",value:function(){this.cue.hit(this.balls[0])}},{key:"serialise",value:function(){return{balls:this.balls.map(function(e){return e.serialise()}),aim:this.cue.aim.copy()}}},{key:"updateFromSerialised",value:function(e){e.balls&&this.balls.forEach(function(t,n){return o.e.updateFromSerialised(t,e.balls[n])}),e.aim&&(this.cue.aim=f.f.fromJson(e.aim))}},{key:"shortSerialise",value:function(){return this.balls.map(function(e){return[e.pos.x,e.pos.y]}).reduce(function(e,t){return e.concat(t)},[])}},{key:"updateFromShortSerialised",value:function(e){this.balls.forEach(function(t,n){t.pos.x=e[2*n],t.pos.y=e[2*n+1]})}}],t=[{key:"fromSerialised",value:function(e){var t=new n(e.balls.map(function(e){return o.e.fromSerialised(e)}));return t.updateFromSerialised(e),t}}],e&&b(n.prototype,e),t&&b(n,t),n}()},"./src/utils/utils.ts":(e,t,n)=>{n.d(t,{AA:()=>u,Bh:()=>r,KO:()=>l,Ls:()=>c,NM:()=>h,a1:()=>o,bM:()=>a,up:()=>s,wK:()=>f});var i=n("./node_modules/three/build/three.module.js"),a=new i.Pa4(0,0,0),s=new i.Pa4(0,0,1);function r(e){return new i.Pa4(e.x,e.y,e.z)}function o(e){return s.clone().cross(e)}function l(e){return e.clone().normalize()}function c(e,t){return 0>=e.clone().add(t).dot(e)}function u(e){return new i.Pa4(1,0,0).applyAxisAngle(s,e)}function h(e){return Math.round((e+Number.EPSILON)*1e3)/1e3}function f(e){return e.x=h(e.x),e.y=h(e.y),e.z=h(e.z),e}},"./src/view/sliders.ts":(e,t,n)=>{n.d(t,{E:()=>r});var i=n("./src/model/physics/constants.ts");function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function(){var e,t;function n(e){var t,a;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),s(this,"style",void 0),s(this,"notify",void 0),this.notify=e,this.style=null!==(a=null===(t=document.getElementById("constants"))||void 0===t?void 0:t.style)&&void 0!==a?a:{},this.initialiseSider("R",i.R,i.Ew),this.initialiseSider("m",i.m,i.fN),this.initialiseSider("e",i.e,i.G3),this.initialiseSider("mu",i.mu,i.dE),this.initialiseSider("muS",i.zv,i.f7),this.initialiseSider("muC",i.Dt,i.Xm),this.initialiseSider("rho",i._5,i.zq)}return e=[{key:"toggleVisibility",value:function(){this.style.visibility="visible"===this.style.visibility?"hidden":"visible"}},{key:"getInputElement",value:function(e){var t;return null!==(t=document.getElementById(e))&&void 0!==t?t:{}}},{key:"initialiseSider",value:function(e,t,n){var i=this,a=this.getInputElement(e);a.step="0.001",a.min="0.01",a.max="1.0",a.value=t,this.showValue(e,t),a.oninput=function(t){var a=parseFloat(t.target.value);n(a),i.showValue(e,a),i.notify&&i.notify()}}},{key:"showValue",value:function(e,t){var n=document.querySelector("label[for=".concat(e,"]"));n&&(n.innerHTML="".concat(e,"=").concat(t))}}],a(n.prototype,e),t&&a(n,t),n}()},"./src/view/tablegeometry.ts":(e,t,n)=>{n.d(t,{H:()=>o});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/model/physics/knuckle.ts"),s=n("./src/model/physics/pocket.ts");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t)}return e=[{key:"addToScene",value:function(e){t.knuckles.forEach(function(n){return t.knuckleCylinder(n,e)}),t.pocketCenters.forEach(function(n){return t.knuckleCylinder(n,e)})}},{key:"knuckleCylinder",value:function(e,n){t.cylinder(e.pos,e.radius,.75,n).position.setZ(-.125)}},{key:"cylinder",value:function(e,n,a,s){var r=new i.fHI(n,n,a,16),o=new i.Kj0(r,t.material);return o.position.copy(e),o.geometry.applyMatrix4(new i.yGw().identity().makeRotationAxis(new i.Pa4(1,0,0),Math.PI/2)),s.add(o),o}},{key:"addCushions",value:function(e){t.plane(new i.Pa4(0,0,-5.5),2*t.X,2*t.Y,10,e);var n=Math.abs(t.pockets.pocketNW.knuckleNE.pos.x-t.pockets.pocketN.knuckleNW.pos.x),a=Math.abs(t.pockets.pocketNW.knuckleSW.pos.y-t.pockets.pocketSW.knuckleNW.pos.y);t.plane(new i.Pa4(t.X+.5,0,-.125),1,a,.75,e),t.plane(new i.Pa4(-t.X-.5,0,-.125),1,a,.75,e),t.plane(new i.Pa4(-t.X/2,t.Y+.5,-.125),n,1,.75,e),t.plane(new i.Pa4(-t.X/2,-t.Y-.5,-.125),n,1,.75,e),t.plane(new i.Pa4(t.X/2,t.Y+.5,-.125),n,1,.75,e),t.plane(new i.Pa4(t.X/2,-t.Y-.5,-.125),n,1,.75,e)}},{key:"plane",value:function(e,n,a,s,r){var o=new i.DvJ(n,a,s),l=new i.Kj0(o,t.material);l.receiveShadow=!0,l.position.copy(e),r.add(l)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();r(o,"tableX",21.5),r(o,"tableY",10.5),r(o,"X",o.tableX+.5),r(o,"Y",o.tableY+.5),r(o,"PX",o.tableX+.8),r(o,"PY",o.tableY+.8),r(o,"knuckleInset",1.6),r(o,"knuckleRadius",.31),r(o,"middleKnuckleInset",1.385),r(o,"middleKnuckleRadius",.2),r(o,"cornerRadius",1.1),r(o,"middleRadius",.9),r(o,"pockets",{pocketNW:{pocket:new s.f(new i.Pa4(-o.PX,o.PY,0),o.cornerRadius),knuckleNE:new a.T(new i.Pa4(-o.X+o.knuckleInset,o.Y+o.knuckleRadius,0),o.knuckleRadius),knuckleSW:new a.T(new i.Pa4(-o.X-o.knuckleRadius,o.Y-o.knuckleInset,0),o.knuckleRadius)},pocketN:{pocket:new s.f(new i.Pa4(0,o.PY+.7,0),o.middleRadius),knuckleNE:new a.T(new i.Pa4(o.middleKnuckleInset,o.Y+o.middleKnuckleRadius,0),o.middleKnuckleRadius),knuckleNW:new a.T(new i.Pa4(-o.middleKnuckleInset,o.Y+o.middleKnuckleRadius,0),o.middleKnuckleRadius)},pocketS:{pocket:new s.f(new i.Pa4(0,-o.PY-.7,0),o.middleRadius),knuckleSE:new a.T(new i.Pa4(o.middleKnuckleInset,-o.Y-o.middleKnuckleRadius,0),o.middleKnuckleRadius),knuckleSW:new a.T(new i.Pa4(-o.middleKnuckleInset,-o.Y-o.middleKnuckleRadius,0),o.middleKnuckleRadius)},pocketNE:{pocket:new s.f(new i.Pa4(o.PX,o.PY,0),o.cornerRadius),knuckleNW:new a.T(new i.Pa4(o.X-o.knuckleInset,o.Y+o.knuckleRadius,0),o.knuckleRadius),knuckleSE:new a.T(new i.Pa4(o.X+o.knuckleRadius,o.Y-o.knuckleInset,0),o.knuckleRadius)},pocketSE:{pocket:new s.f(new i.Pa4(o.PX,-o.PY,0),o.cornerRadius),knuckleNE:new a.T(new i.Pa4(o.X+o.knuckleRadius,-o.Y+o.knuckleInset,0),o.knuckleRadius),knuckleSW:new a.T(new i.Pa4(o.X-o.knuckleInset,-o.Y-o.knuckleRadius,0),o.knuckleRadius)},pocketSW:{pocket:new s.f(new i.Pa4(-o.PX,-o.PY,0),o.cornerRadius),knuckleSE:new a.T(new i.Pa4(-o.X+o.knuckleInset,-o.Y-o.knuckleRadius,0),o.knuckleRadius),knuckleNW:new a.T(new i.Pa4(-o.X-o.knuckleRadius,-o.Y+o.knuckleInset,0),o.knuckleRadius)}}),r(o,"knuckles",[o.pockets.pocketNW.knuckleNE,o.pockets.pocketNW.knuckleSW,o.pockets.pocketN.knuckleNW,o.pockets.pocketN.knuckleNE,o.pockets.pocketS.knuckleSW,o.pockets.pocketS.knuckleSE,o.pockets.pocketNE.knuckleNW,o.pockets.pocketNE.knuckleSE,o.pockets.pocketSE.knuckleNE,o.pockets.pocketSE.knuckleSW,o.pockets.pocketSW.knuckleSE,o.pockets.pocketSW.knuckleNW]),r(o,"pocketCenters",[o.pockets.pocketNW.pocket,o.pockets.pocketSW.pocket,o.pockets.pocketN.pocket,o.pockets.pocketS.pocket,o.pockets.pocketNE.pocket,o.pockets.pocketSE.pocket]),r(o,"material",new i.xoR({color:4478361,wireframe:!1,flatShading:!0,transparent:!0,opacity:.4}))}},e=>{e(e.s="./src/diagrams.ts")}]);