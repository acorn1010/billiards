"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[465],{"./src/diagrams.ts":(e,t,n)=>{var i=n("./src/model/table.ts"),a=n("./src/view/tablegeometry.ts");function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"state",void 0),o(this,"control",void 0),this.state=t,this.control=n,this.addControls(n,i)}var t,n,i;return t=e,n=[{key:"readValue",value:function(e){var t=this.control.querySelector(e);return t?t.valueAsNumber:0}},{key:"readControls",value:function(){var e=this.state.balls[0];e.pos.x=this.readValue("#x"),e.pos.y=this.readValue("#y"),e.vel.x=this.readValue("#vx"),e.vel.y=this.readValue("#vy"),e.rvel.x=this.readValue("#wx"),e.rvel.y=this.readValue("#wy"),e.rvel.z=this.readValue("#wz")}},{key:"addControls",value:function(e,t){var n=this.state.balls[0],i='type="number" step="0.1"';e.innerHTML='\n        x <input id="x" '.concat(i,' value="').concat(n.pos.x,'">\n\t\t  <input id="y" ').concat(i,' value="').concat(n.pos.y,'">\n        ẋ <input id="vx" ').concat(i,' value="').concat(n.vel.x,'">\n\t\t  <input id="vy" ').concat(i,' value="').concat(n.vel.y,'">\n        ω <input id="wx" ').concat(i,' value="').concat(n.rvel.x,'">\n\t\t  <input id="wy" ').concat(i,' value="').concat(n.rvel.y,'">\n          <input id="wz" ').concat(i,' value="').concat(n.rvel.z,'"><button type="button">replay</button>'),e.getElementsByTagName("button")[0].onclick=t}}],n&&r(t.prototype,n),i&&r(t,i),e}();function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t,n,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"table",void 0),c(this,"diagram",void 0),c(this,"diagramInputs",void 0),c(this,"last",performance.now()),c(this,"step",.001),c(this,"tablecolor","#0a5c5c"),c(this,"colors",["#aaaaaa","#ff0000","#ffff00"]),this.table=i.i.fromSerialised(t),this.diagram=n,this.diagramInputs=new s(t,a,(function(){return r.restart()})),this.scale(),this.drawTable(),this.animate(this.last)}var t,n,r;return t=e,n=[{key:"scale",value:function(){var e=this.diagram.canvas.clientWidth,t=this.diagram.canvas.clientHeight,n=.45*e/a.H.X;this.diagram.setTransform(n,0,0,n,.5*e,.5*t)}},{key:"drawTable",value:function(){var e=a.H.X,t=a.H.Y;this.diagram.fillStyle=this.tablecolor,this.diagram.fillRect(-e,-t,2*e,2*t)}},{key:"drawBall",value:function(e,t,n){this.diagram.fillStyle=n,this.diagram.beginPath(),this.diagram.ellipse(e,t,.5,.5,0,0,2*Math.PI),this.diagram.fill()}},{key:"drawBalls",value:function(){var e=this,t=0;this.table.balls.forEach((function(n){return e.drawBall(n.pos.x,n.pos.y,e.colors[t++])}))}},{key:"clearBalls",value:function(){var e=this;this.table.balls.forEach((function(t){return e.drawBall(t.pos.x,t.pos.y,e.tablecolor)}))}},{key:"advance",value:function(e){for(var t=Math.floor(e/this.step),n=0;n<t;n++)this.table.advance(this.step)}},{key:"animate",value:function(e){var t=this;this.clearBalls(),this.advance((e-this.last)/1e3),this.last=e,this.drawBalls(),this.table.allStationary()||requestAnimationFrame((function(e){t.animate(e)}))}},{key:"restart",value:function(){this.diagramInputs.readControls(),this.table.updateFromSerialised(this.diagramInputs.state),this.drawTable(),this.last=performance.now(),this.animate(this.last)}}],n&&l(t.prototype,n),r&&l(t,r),e}(),h=n("./src/model/physics/physics.ts"),f=n("./node_modules/three/build/three.module.js");function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"canvas",void 0),d(this,"context",void 0),d(this,"endx",100),d(this,"endy",100),d(this,"scale",75),d(this,"r",20),d(this,"dv",new f.Pa4),d(this,"dw",new f.Pa4),t.firstElementChild.innerHTML=n,this.canvas=t.lastElementChild,this.context=this.canvas.getContext("2d")}var t,n,i;return t=e,n=[{key:"drawBall",value:function(){this.context.beginPath(),this.context.strokeStyle="lightgray",this.context.fillStyle="beige",this.context.arc(this.endx,this.endy,this.r,0,2*Math.PI,!1),this.context.fill(),this.context.stroke()}},{key:"drawCushion",value:function(){var e=this.context.createLinearGradient(10,90,200,90);e.addColorStop(0,"lightgray"),e.addColorStop(.75,"white"),this.context.fillStyle=e,this.context.fillRect(this.endx+this.r,10,200,250)}},{key:"plot",value:function(e,t,n,i,a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCushion(),this.drawBall();for(var r=e;r<=t;r+=n){var o=i(r),s=a(r),l=(0,h.vZ)(o,s)?[]:[2,2];this.context.setLineDash(l);var c=101*(r+360)%360;this.context.strokeStyle="hsl(".concat(c,",50%,50%)"),this.drawArrow(this.endx-o.x*this.scale,this.endy-o.y*this.scale,this.endx,this.endy),(0,h.ZI)(0,o,s,this.dv,this.dw),o.add(this.dv),this.drawArrow(this.endx,this.endy,this.endx+o.x*this.scale,this.endy+o.y*this.scale)}}},{key:"drawArrow",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.9,r={x:(n-e)*a+e,y:(i-t)*a+t},o=n-r.x,s=i-r.y;this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(r.x,r.y),this.context.moveTo(r.x+.5*s,r.y-.5*o),this.context.lineTo(r.x-.5*s,r.y+.5*o),this.context.lineTo(n,i),this.context.closePath(),this.context.stroke()}}],n&&p(t.prototype,n),i&&p(t,i),e}(),y=n("./src/model/physics/constants.ts");function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var g=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"canvas",void 0),b(this,"ctx",void 0),b(this,"xAxis",void 0),b(this,"yAxis",void 0),b(this,"gutter",20),this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.canvas.previousElementSibling.innerHTML=n,this.canvas.nextElementSibling.innerHTML=i}var t,n,i;return t=e,(n=[{key:"plot",value:function(e,t,n){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.shadowColor="grey",this.ctx.shadowBlur=2,this.xAxis=this.axisInfo(e,this.canvas.width),this.yAxis=this.axisInfo(w(t).concat(w(n)),this.canvas.height),this.drawXAxis(e),this.plotLine(e,t,"blue"),this.plotLine(e,n,"red")}},{key:"plotLine",value:function(e,t,n){this.ctx.beginPath();for(var i=0;i<e.length;i++){var a=this.scale(e[i],this.xAxis),r=this.canvas.height-.8*this.scale(t[i],this.yAxis)-this.gutter;0===i?this.ctx.moveTo(a,r):this.ctx.lineTo(a,r)}this.ctx.strokeStyle=n,this.ctx.stroke()}},{key:"drawXAxis",value:function(e){var t=this.canvas.height-this.gutter;this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.strokeStyle="grey",this.ctx.stroke(),this.ctx.font="8px Arial",this.ctx.strokeStyle="grey";for(var n=!1,i=2;i<e.length-2;i++){var a=this.scale(e[i],this.xAxis);this.ctx.beginPath(),this.ctx.moveTo(a,t),this.ctx.lineTo(a,t+4),this.ctx.stroke(),n||this.ctx.fillText(e[i],a-5,t+10),n=!n}}},{key:"scale",value:function(e,t){return(e-t.min)*t.scale}},{key:"axisInfo",value:function(e,t){var n,i,a=(n=Math).min.apply(n,w(e)),r=(i=Math).max.apply(i,w(e));return{min:a,max:r,scale:t/(r-a||1)}}}])&&m(t.prototype,n),i&&m(t,i),e}(),x=n("./src/model/ball.ts"),P=n("./src/utils/utils.ts");function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A,R,T,I,O,C,E,N,j,B=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),M(this,"ball",void 0),M(this,"theta",0),M(this,"canvas",void 0),M(this,"ctx",void 0),M(this,"step",.01),this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.ball=new x.e(P.bM),this.ball.vel=new f.Pa4(8.5,0,0),this.ball.rvel=new f.Pa4(0,0*this.ball.vel.x/y.R,0),this.ball.state=x.Z.Sliding}var t,n,i;return t=e,n=[{key:"drawBall",value:function(e,t,n){var i=this.canvas.width,a=this.canvas.height,r=i/(27*y.R);this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n;var o=e*r+2*y.R*r,s=t*r+a/2,l=y.R*r;this.ctx.ellipse(o,s,l,l,0,0,2*Math.PI),this.ctx.stroke();var c=o+y.R*-Math.sin(this.theta)*r,u=s+y.R*Math.cos(this.theta)*r;this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(o,s),this.ctx.lineTo(c,u),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="black",this.ctx.arc(c,u,3,0,2*Math.PI),this.ctx.fill()}},{key:"advance",value:function(e){this.ball.update(e);var t=this.ball.rvel.length()*e;this.theta+=t}},{key:"draw",value:function(e){this.ctx.clearRect(0,0,1,1);for(var t=0;t<e;){var n="blue";this.ball.isRolling()?n="red":this.ball.inMotion()&&(n="green"),this.drawBall(this.ball.pos.x,0,n),this.advance(this.step),t+=this.step}}}],n&&S(t.prototype,n),i&&S(t,i),e}(),H=20,z=L("rollcanvas");z?new B(z).draw(5):(K("diagram1",[F(0,0,-20,0,0,0,0),F(2,2,-20,0,0,0,H),F(-2,-2,-20,0,0,0,-20)]),K("diagram2",[F(-17,2,0,-40,-85,0,-35),F(-17.38,-2,0,0,0,0,0)]),A=new v(L("cushion1"),"stun shot"),R=new v(L("cushion2"),"running side"),T=new v(L("cushion3"),"check side"),I=new v(L("cushion4"),"varying side"),O=new v(L("cushion5"),"varying side high vel"),C=new g("plot1","Spinning ball played slowly directly into cushion","top/back spin w.y"),E=new g("plot2","Spinning ball played hard directly into cushion","top/back spin w.y"),N=new g("plot3","Right hand spinning ball with varying incident angle","Incident angle (degrees) of ball to cushion with right side"),j=new g("plot4","Cushion friction (mu) varies with incident angle","Incident angle (degrees) of ball to cushion"),V(),Y(),X("R",y.Ew),X("m",y.fN),X("e",y.G3),X("mu",y.dE),X("muS",y.f7),X("muC",y.Xm),X("rho",y.zq),X("s",(function(e){W=e})));var W=1;function X(e,t){L(e).oninput=function(n){var i=parseFloat(n.target.value);t(i),document.querySelector("label[for=".concat(e,"]")).innerHTML="".concat(e,"=").concat(i),Y(),V()}}function Y(){var e=function(e){return function(t){return new f.Pa4(0,0,e)}},t=function(e){return new f.Pa4(function(e){return Math.cos(e*Math.PI/180)}(e),function(e){return Math.sin(e*Math.PI/180)}(e),0)};A.plot(10,80,10,t,(function(e){return new f.Pa4(0,0,0)})),R.plot(10,80,10,t,e(-3)),T.plot(10,80,10,t,e(3)),I.plot(-6,6,1,(function(e){return new f.Pa4(.7,.7,0)}),(function(e){return new f.Pa4(0,0,e)})),O.plot(-6,6,1,(function(e){return new f.Pa4(2,2,0)}),(function(e){return new f.Pa4(0,0,e)}))}function V(){!function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new f.Pa4(1,0,0),r=new f.Pa4(0,0,i);t.push((0,h.NP)((0,h.c0)(a))),n.push((0,h.al)((0,h.s0)(a,r)))}C.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-20;i<=20;i+=1){e.push(i);var a=new f.Pa4(1,0,0),r=new f.Pa4(0,i,0);t.push((0,h.NP)((0,h.c0)(a))),n.push((0,h.al)((0,h.s0)(a,r)))}E.plot(e,t,n)}(),function(){for(var e=[],t=[],n=[],i=-80;i<=80;i+=10){e.push(i);var a=i*Math.PI/180,r=new f.Pa4(Math.cos(a),Math.sin(a),0);r.multiplyScalar(W);var o=new f.Pa4(0,0,-10);t.push((0,h.NP)((0,h.c0)(r))),n.push((0,h.al)((0,h.s0)(r,o)))}N.plot(e,t,n)}(),function(){for(var e=[],t=[],n=-80;n<=80;n+=10){e.push(n);var i=n*Math.PI/180,a=new f.Pa4(Math.cos(i),Math.sin(i),0),r=(0,h.GK)(a);t.push(r)}j.plot(e,t,t)}()}function K(e,t){return new u({balls:t},Z(e,"canvas").getContext("2d"),Z(e,"control"))}function F(e,t,n,i,a,r,o){return{pos:{x:e,y:t,z:0},vel:{x:n,y:i,z:0},rvel:{x:a,y:r,z:o},state:"Sliding"}}function L(e){return document.getElementById(e)}function Z(e,t){var n="#"+e+" #"+t,i=document.querySelector(n);if(null==i)throw new Error("Element not found "+n);return i}},"./src/events/aimevent.ts":(e,t,n)=>{n.d(t,{f:()=>d});var i=n("./src/events/gameevent.ts"),a=n("./src/events/eventtype.ts"),r=n("./src/utils/utils.ts"),o=n("./node_modules/three/build/three.module.js");function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function h(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?s(e):t;var n}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=u(e);if(t){var a=u(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return h(this,n)}}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(h,e);var t,n,i,u=p(h);function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),c(s(e=u.call(this)),"verticalOffset",0),c(s(e),"sideOffset",0),c(s(e),"angle",0),c(s(e),"power",0),c(s(e),"pos",new o.Pa4(0,0,0)),e.type=a.t.AIM,e}return t=h,i=[{key:"fromJson",value:function(e){var t=new h;return t.pos=(0,r.Bh)(e.pos),t.angle=e.angle,t.verticalOffset=e.verticalOffset,t.sideOffset=e.sideOffset,t.power=e.power,t}}],(n=[{key:"applyToController",value:function(e){return e.handleAim(this)}},{key:"copy",value:function(){return h.fromJson(this)}},{key:"round",value:function(){this.angle=(0,r.NM)(this.angle),this.power=(0,r.NM)(this.power),this.verticalOffset=(0,r.NM)(this.verticalOffset),this.sideOffset=(0,r.NM)(this.sideOffset)}}])&&l(t.prototype,n),i&&l(t,i),h}(i.Z)},"./src/events/eventtype.ts":(e,t,n)=>{var i;n.d(t,{t:()=>i}),function(e){e.BEGIN="BEGIN",e.BREAK="BREAK",e.WATCHAIM="WATCHAIM",e.AIM="AIM",e.HIT="HIT",e.STATIONARY="STATIONARY",e.CHAT="CHAT",e.ABORT="ABORT",e.PLACEBALL="PLACEBALL"}(i||(i={}))},"./src/events/gameevent.ts":(e,t,n)=>{n.d(t,{Z:()=>i});var i=function e(){var t,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(n="type")in(t=this)?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}},"./src/model/ball.ts":(e,t,n)=>{n.d(t,{e:()=>p,Z:()=>l});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/utils/utils.ts"),r=n("./src/model/physics/physics.ts");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l,c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"mesh",void 0),s(this,"shadow",void 0),s(this,"spinAxisArrow",void 0),s(this,"m",new i.yGw),this.initialiseMesh(t)}var t,n,r;return t=e,(n=[{key:"updatePosition",value:function(e){this.mesh.position.copy(e),this.shadow.position.copy(e)}},{key:"updateRotation",value:function(e,t){var n=e.length()*t,i=this.m.identity().makeRotationAxis((0,a.KO)(e),n);this.mesh.geometry.applyMatrix4(i)}},{key:"updateArrows",value:function(e,t,n){this.spinAxisArrow.setLength(.4+t.length()/2,.1,.1),this.spinAxisArrow.position.copy(e),this.spinAxisArrow.setDirection((0,a.KO)(t)),n==l.Rolling?this.spinAxisArrow.setColor(16711680):this.spinAxisArrow.setColor(65280)}},{key:"initialiseMesh",value:function(e){var t=new i.cJO(.5,1),n=new i.xoR({emissive:0,flatShading:!0,vertexColors:!0});this.addDots(t,e),this.mesh=new i.Kj0(t,n),this.mesh.name="ball",this.updateRotation((new i.Pa4).random(),1);var r=new i.zf8(.45,9);r.applyMatrix4((new i.yGw).identity().makeTranslation(0,0,-.49));var o=new i.vBJ({color:1118498});this.shadow=new i.Kj0(r,o),this.spinAxisArrow=new i.tGC(a.up,a.bM,2,0),this.spinAxisArrow.visible=!1}},{key:"addDots",value:function(e,t){var n=this,a=e.attributes.position.count,r=new i.Ilk(t),o=new i.Ilk(11149858);e.setAttribute("color",new i.TlE(new Float32Array(3*a),3));for(var s=e.attributes.color,l=0;l<a/3;l++)this.colorVerticesForFace(l,s,r.r,r.g,r.b);[0,96,111,156,186,195].forEach((function(e){n.colorVerticesForFace(e/3,s,o.r,o.g,o.b)}))}},{key:"colorVerticesForFace",value:function(e,t,n,i,a){t.setXYZ(3*e+0,n,i,a),t.setXYZ(3*e+1,n,i,a),t.setXYZ(3*e+2,n,i,a)}}])&&o(t.prototype,n),r&&o(t,r),e}(),u=n("./src/model/physics/constants.ts");function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Stationary="Stationary",e.Rolling="Rolling",e.Sliding="Sliding",e.Falling="Falling",e.InPocket="InPocket"}(l||(l={}));var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),f(this,"pos",void 0),f(this,"vel",a.bM.clone()),f(this,"rvel",a.bM.clone()),f(this,"state",l.Stationary),f(this,"pocket",void 0),f(this,"futurePos",a.bM.clone()),f(this,"ballmesh",void 0),f(this,"transition",.05),f(this,"dv",new i.Pa4),f(this,"dw",new i.Pa4),this.pos=t.clone(),this.ballmesh=new c(n||5592405*Math.random())}var t,n,o;return t=e,o=[{key:"fromSerialised",value:function(t){return e.updateFromSerialised(new e((0,a.Bh)(t.pos)),t)}},{key:"updateFromSerialised",value:function(e,t){return e.pos.copy(t.pos),e.vel.copy((0,a.Bh)(t.vel)),e.rvel.copy((0,a.Bh)(t.rvel)),e.state=t.state,e}}],(n=[{key:"update",value:function(e){this.updatePosition(e),this.updateVelocity(e),this.state==l.Falling&&this.updateFalling(e)}},{key:"updateMesh",value:function(e){this.ballmesh.updatePosition(this.pos),this.ballmesh.updateArrows(this.pos,this.rvel,this.state),0!==this.rvel.lengthSq()&&this.ballmesh.updateRotation(this.rvel,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e)}},{key:"updateFalling",value:function(e){if(this.vel.addScaledVector(a.up,-10*e*u.g),this.pos.z<-2&&(this.pos.z+=i.M8C.randFloat(-.5,.25),this.setStationary(),this.state=l.InPocket),this.pos.distanceTo(this.pocket.pos)>this.pocket.radius-.5){var t=this.pocket.pos.clone().sub(this.pos).normalize().multiplyScalar(.5*this.vel.length());this.vel.dot(t)<0&&(this.vel.x=t.x,this.vel.y=t.y)}}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?this.updateVelocityRolling(e):this.updateVelocitySliding(e))}},{key:"updateVelocityRolling",value:function(e){(0,r.QC)(this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,a.Ls)(this.rvel,this.dw)||(0,a.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=l.Rolling)}},{key:"updateVelocitySliding",value:function(e){(0,r.Vp)(this.vel,this.rvel,this.dv,this.dw),this.dv.multiplyScalar(e),this.dw.multiplyScalar(e),(0,a.Ls)(this.rvel,this.dw)&&(0,a.Ls)(this.vel,this.dv)?this.setStationary():(this.vel.add(this.dv),this.rvel.add(this.dw),this.state=l.Sliding)}},{key:"setStationary",value:function(){this.vel.copy(a.bM),this.rvel.copy(a.bM),this.state=l.Stationary}},{key:"isRolling",value:function(){return 0!=this.vel.lengthSq()&&0!=this.rvel.lengthSq()&&(0,r.E9)(this.vel,this.rvel).length()<this.transition}},{key:"onTable",value:function(){return this.state!==l.Falling&&this.state!==l.InPocket}},{key:"inMotion",value:function(){return this.state==l.Rolling||this.state==l.Sliding}},{key:"isFalling",value:function(){return this.state==l.Falling}},{key:"futurePosition",value:function(e){return this.futurePos.copy(this.pos).addScaledVector(this.vel,e),this.futurePos}},{key:"serialise",value:function(){return{pos:this.pos,vel:this.vel,rvel:this.rvel,state:this.state}}}])&&h(t.prototype,n),o&&h(t,o),e}()},"./src/model/outcome.ts":(e,t,n)=>{function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r;n.d(t,{k:()=>o}),function(e){e.Pot="Pot",e.Cushion="Cushion",e.Collision="Collision",e.Hit="Hit"}(r||(r={}));var o=function(){function e(t,n,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"type",void 0),a(this,"timestamp",void 0),a(this,"ballA",null),a(this,"ballB",null),a(this,"incidentSpeed",void 0),this.type=t,this.ballA=n,this.ballB=i,this.incidentSpeed=r,this.timestamp=Date.now()}var t,n,o;return t=e,o=[{key:"pot",value:function(t,n){return new e(r.Pot,t,t,n)}},{key:"cushion",value:function(t,n){return new e(r.Cushion,t,t,n)}},{key:"collision",value:function(t,n,i){return new e(r.Collision,t,n,i)}},{key:"hit",value:function(t,n){return new e(r.Hit,t,t,n)}},{key:"isCueBallPotted",value:function(e,t){return t.some((function(t){return t.type==r.Pot&&t.ballA===e}))}},{key:"isBallPottedNoFoul",value:function(t,n){return n.some((function(e){return e.type==r.Pot&&null!==e.ballA}))&&!e.isCueBallPotted(t,n)}}],(n=null)&&i(t.prototype,n),o&&i(t,o),e}()},"./src/model/physics/constants.ts":(e,t,n)=>{n.d(t,{Dt:()=>c,Ew:()=>v,G3:()=>w,Hz:()=>a,I:()=>r,Mz:()=>i,R:()=>f,Xm:()=>g,dE:()=>k,e:()=>p,f7:()=>b,fN:()=>y,g:()=>o,m:()=>h,zq:()=>m,zv:()=>l});var i,a,r,o=9.8,s=.29,l=.89,c=.4,u=.4,h=.2,f=.5,p=.85;function d(){i=s*h*o*2/3*u,a=7/(5*Math.sqrt(2))*f*s*h*o,r=.4*h*f*f}function v(e){f=e,d()}function y(e){h=e,d()}function k(e){s=e,d()}function m(e){u=e,d()}function b(e){l=e}function w(e){p=e}function g(e){c=e}d()},"./src/model/physics/knuckle.ts":(e,t,n)=>{n.d(t,{T:()=>s});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/constants.ts");function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"pos",void 0),o(this,"radius",void 0),this.pos=t,this.radius=n}var t,n,s;return t=e,s=[{key:"willBounce",value:function(e,t){return t.distanceTo(e.pos)<.5+e.radius}},{key:"findBouncing",value:function(t,n){var a=t.futurePosition(n);return i.H.knuckles.find((function(t){return e.willBounce(t,a)}))}}],(n=[{key:"bounce",value:function(e){var t=e.pos.clone().sub(this.pos).normalize(),n=t.dot(e.vel);return e.vel.addScaledVector(t,-2*a.e*n),Math.abs(n)}}])&&r(t.prototype,n),s&&r(t,s),e}()},"./src/model/physics/physics.ts":(e,t,n)=>{n.d(t,{E9:()=>s,GK:()=>w,NP:()=>m,QC:()=>c,Vp:()=>l,WL:()=>g,ZI:()=>u,al:()=>k,c0:()=>y,s0:()=>v,vZ:()=>b});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/utils/utils.ts"),r=n("./src/model/physics/constants.ts");function o(e,t){return s(e,t).setZ(0)}function s(e,t){return e.clone().addScaledVector((0,a.a1)(t),r.R)}function l(e,t,n,i){var s=o(e,t);n.copy((0,a.KO)(s).multiplyScalar(-r.zv*r.g)),i.copy((0,a.KO)((0,a.a1)(s)).multiplyScalar(2.5*r.zv*r.g/r.R)),i.setZ(r.Mz/(r.R*r.R)*-2.5*Math.sign(t.z))}function c(e,t,n){var a=new i.Pa4(e.x,e.y,0).length(),o=5/7*r.Hz/(r.m*r.R)/a,s=5/7*r.Hz/(r.m*r.R*r.R)/a;t.set(-o*e.y,o*e.x,0),n.set(-s*e.x,-s*e.y,r.Mz/(r.m*r.R*r.R)*-2.5*Math.sign(e.z))}function u(e,t,n,i,o){!function(e,t,n,i){var a,o,s=y(e),l=v(e,t),c=m(s),u=k(l),h=3.5/r.m,f=1/r.m,b=(1+r.e)*(s/f),g=0;if(u<c)a=-l.x/h*p-b*d,o=l.y/h,g=l.x/h*d-b*p;else{var x=w(e),P=Math.abs(Math.atan2(e.y,e.x)),S=Math.cos(P),M=Math.sin(P);a=-x*b*S*d-b*d,o=x*b*M,g=x*b*S*d-b*p}n.x=a/r.m,n.y=o/r.m,i.x=-r.R/r.I*o*p,i.y=r.R/r.I*(a*p-g*d),i.z=r.R/r.I*o*d}(t.clone().applyAxisAngle(a.up,e),n.clone().applyAxisAngle(a.up,e),i,o),i.applyAxisAngle(a.up,-e),o.applyAxisAngle(a.up,-e)}var h=.2*r.R,f=Math.asin(h/r.R),p=Math.sin(f),d=Math.cos(f);function v(e,t){return new i.Pa4(e.x*p-e.z*d+r.R*t.y,-e.y-r.R*t.z*d+r.R*t.x*p)}function y(e){return e.x*d}function k(e){var t=3.5/r.m;return e.length()/t}function m(e){var t=1/r.m;return r.Dt*((1+r.e)*e)/t}function b(e,t){var n=m(y(e));return k(v(e,t))<=n}function w(e){return.2-.1*Math.atan2(Math.abs(e.y),e.x)}function g(e,t){var n=Math.atan2(-e.x,e.y),i=2.5*t.length()*(e.length()*r.R)/(r.R*r.R),o=t.clone().normalize();return(0,a.a1)(o).applyAxisAngle(o,n).multiplyScalar(i)}},"./src/model/physics/pocket.ts":(e,t,n)=>{n.d(t,{f:()=>l});var i=n("./src/model/ball.ts"),a=n("./src/view/tablegeometry.ts"),r=n("./src/model/physics/constants.ts");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"pos",void 0),s(this,"radius",void 0),this.pos=t,this.radius=n}var t,n,l;return t=e,l=[{key:"willFall",value:function(e,t){return t.distanceTo(e.pos)<e.radius}},{key:"findPocket",value:function(t,n){var i=t.futurePosition(n);return a.H.pocketCenters.find((function(t){return e.willFall(t,i)}))}}],(n=[{key:"fall",value:function(e,t){return e.vel.z=-r.g*t,e.state=i.Z.Falling,e.pocket=this,e.vel.length()}}])&&o(t.prototype,n),l&&o(t,l),e}()},"./src/model/table.ts":(e,t,n)=>{n.d(t,{i:()=>S});var i=n("./src/view/tablegeometry.ts"),a=n("./src/model/physics/physics.ts"),r=n("./node_modules/three/build/three.module.js");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,s=[{key:"bounceAny",value:function(t,n){var a=t.futurePosition(n);if(e.willBounceLongSegment(i.H.pockets.pocketNW.knuckleNE.pos.x,i.H.pockets.pocketN.knuckleNW.pos.x,a)||e.willBounceLongSegment(i.H.pockets.pocketN.knuckleNE.pos.x,i.H.pockets.pocketNE.knuckleNW.pos.x,a)){var r=a.y>i.H.tableY?-Math.PI/2:Math.PI/2;return e.bounceIn(r,t)}if(e.willBounceShortSegment(i.H.pockets.pocketNW.knuckleSW.pos.y,i.H.pockets.pocketSW.knuckleNW.pos.y,a)){var o=a.x>i.H.tableX?0:Math.PI;return e.bounceIn(o,t)}}},{key:"willBounceLongSegment",value:function(e,t,n){return n.x>e&&n.x<t&&Math.abs(n.y)>i.H.tableY}},{key:"willBounceShortSegment",value:function(e,t,n){return n.y>t&&n.y<e&&Math.abs(n.x)>i.H.tableX}},{key:"bounceIn",value:function(e,t){var n=new r.Pa4,i=new r.Pa4;return(0,a.ZI)(e,t.vel,t.rvel,n,i),t.vel.add(n),t.rvel.add(i),n.length()}}],(n=null)&&o(t.prototype,n),s&&o(t,s),e}(),l=n("./src/model/ball.ts");function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"willCollide",value:function(e,t,n){return(e.inMotion()||t.inMotion())&&e.onTable()&&t.onTable()&&e.futurePosition(n).distanceToSquared(t.futurePosition(n))<1}},{key:"collide",value:function(t,n){return e.updateVelocities(t,n)}},{key:"updateVelocities",value:function(e,t){var n=t.pos.clone().sub(e.pos).normalize(),i=n.dot(e.vel),a=n.dot(t.vel);return e.vel.addScaledVector(n,a).addScaledVector(n,-i),t.vel.addScaledVector(n,i).addScaledVector(n,-a),e.state=l.Z.Sliding,t.state=l.Z.Sliding,Math.abs(i)+Math.abs(a)}}],(n=null)&&c(t.prototype,n),i&&c(t,i),e}(),h=n("./src/model/physics/knuckle.ts"),f=n("./src/model/physics/pocket.ts"),p=n("./src/utils/utils.ts"),d=n("./src/events/aimevent.ts");function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"createHelper",value:function(){var e=new r.fHI(.5,.5,30,12,1,!0),t=new r.Kj0(e,this.helpermaterial);return t.geometry.applyMatrix4((new r.yGw).identity().makeRotationAxis(p.up,-Math.PI/2)).applyMatrix4((new r.yGw).identity().makeTranslation(15,0,-.01)),t.visible=!1,t.renderOrder=-1,t.material.depthTest=!1,t}},{key:"createPlacer",value:function(){var t=new r.fHI(.01,.5,.5,4),n=new r.Kj0(t,e.helpermaterial);return n.geometry.applyMatrix4((new r.yGw).identity().makeRotationAxis(new r.Pa4(1,0,0),-Math.PI/2)).applyMatrix4((new r.yGw).identity().makeTranslation(0,0,.7)),n.visible=!1,n}},{key:"createCue",value:function(t,n,i){var a=new r.fHI(t,n,i,11),o=new r.Kj0(a,e.material);return o.castShadow=!1,o.geometry.applyMatrix4((new r.yGw).identity().makeRotationAxis(new r.Pa4(1,0,0),-.1)).applyMatrix4((new r.yGw).identity().makeRotationAxis(p.up,-Math.PI/2)).applyMatrix4((new r.yGw).identity().makeTranslation(-i/2-.5,0,1)),o}}],(n=null)&&v(t.prototype,n),i&&v(t,i),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}y(k,"material",new r.xoR({color:8934775,wireframe:!1,flatShading:!1})),y(k,"helpermaterial",new r.jyz({uniforms:{lightDirection:{value:new r.Pa4(0,0,1)}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;  \n      void main() {\n        vNormal = normal;\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n      }\n    ",fragmentShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      uniform vec3 lightDirection;\n      void main() {\n        float intensity = dot(vNormal, lightDirection);\n        vec3 color = vec3(1.0, 1.0, 1.0);\n        vec3 finalColor = color * intensity;\n        gl_FragColor = vec4(finalColor, 0.05 * (1.0-vUv.y));\n      }\n    ",wireframe:!1,transparent:!0}));var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"mesh",void 0),b(this,"helperMesh",void 0),b(this,"placerMesh",void 0),b(this,"limit",.5),b(this,"maxPower",60),b(this,"t",0),b(this,"aimInputs",void 0),b(this,"aim",new d.f),b(this,"length",1*i.H.tableX),this.mesh=k.createCue(.05,.15,this.length),this.helperMesh=k.createHelper(),this.placerMesh=k.createPlacer()}var t,n,o;return t=e,(n=[{key:"rotateAim",value:function(e){this.aim.angle+=e,this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle}},{key:"adjustHeight",value:function(e){this.aim.verticalOffset=r.M8C.clamp(this.aim.verticalOffset+e,-this.limit,this.limit),this.mesh.position.z=this.aim.verticalOffset,this.updateAimInput()}},{key:"adjustSide",value:function(e){this.aim.sideOffset=r.M8C.clamp(this.aim.sideOffset+e,-this.limit,this.limit),this.updateAimInput()}},{key:"adjustPower",value:function(e){this.aim.power=Math.min(this.maxPower,this.aim.power+e),this.updateAimInput()}},{key:"setPower",value:function(e){this.aim.power=e*this.maxPower}},{key:"hit",value:function(e){var t=this.aim;e.state=l.Z.Sliding,e.vel.copy((0,p.AA)(t.angle).multiplyScalar(t.power));var n=new r.Pa4(t.sideOffset,t.verticalOffset,0);e.rvel.copy((0,a.WL)(n,e.vel))}},{key:"setSpin",value:function(e,t){var n=new r.Pa4(e,t);n.length()>.26&&n.normalize().multiplyScalar(.25),this.aim.verticalOffset=n.y,this.aim.sideOffset=n.x,this.updateAimInput()}},{key:"updateAimInput",value:function(){var e,t;null===(e=this.aimInputs)||void 0===e||e.updateVisualState(this.aim.sideOffset,this.aim.verticalOffset),null===(t=this.aimInputs)||void 0===t||t.updatePowerSlider(this.aim.power/this.maxPower)}},{key:"moveTo",value:function(e){this.aim.pos.copy(e),this.mesh.rotation.z=this.aim.angle,this.helperMesh.rotation.z=this.aim.angle;var t=(0,p.a1)((0,p.AA)(this.aim.angle)).multiplyScalar(this.aim.sideOffset).setZ(this.aim.verticalOffset),n=.25*(Math.sin(this.t/3)-1),i=(0,p.AA)(this.aim.angle).clone().multiplyScalar(n-this.aim.power/this.maxPower*3);this.mesh.position.copy(e.clone().add(t).add(i)),this.helperMesh.position.copy(e),this.placerMesh.position.copy(e),this.placerMesh.rotation.z=this.t}},{key:"update",value:function(e){this.t+=e,this.moveTo(this.aim.pos)}},{key:"placeBallMode",value:function(){this.mesh.visible=!1,this.placerMesh.visible=!0}},{key:"aimMode",value:function(){this.mesh.visible=!0,this.placerMesh.visible=!1}},{key:"intersectsAnything",value:function(e){var t=e.balls[0].pos.clone().addScaledVector((0,p.AA)(this.aim.angle),-this.length/2);t.z=this.aim.verticalOffset;var n=(0,p.AA)(this.aim.angle);return new r.iMs(t,n,0,this.length/2-.6).intersectObjects(e.balls.map((function(e){return e.ballmesh.mesh}))).length>0}},{key:"showHelper",value:function(e){this.helperMesh.visible=e}},{key:"toggleHelper",value:function(){this.showHelper(!this.helperMesh.visible)}}])&&m(t.prototype,n),o&&m(t,o),e}(),g=n("./src/model/outcome.ts");function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"balls",void 0),P(this,"cue",new w),P(this,"pairs",void 0),P(this,"outcome",[]),this.initialiseBalls(t)}var t,n,a;return t=e,a=[{key:"fromSerialised",value:function(t){var n=new e(t.balls.map((function(e){return l.e.fromSerialised(e)})));return n.updateFromSerialised(t),n}}],(n=[{key:"initialiseBalls",value:function(e){this.balls=e,this.pairs=[];for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)t<n&&this.pairs.push({a:e[t],b:e[n]})}},{key:"updateBallMesh",value:function(e){this.balls.forEach((function(t){t.updateMesh(e)}))}},{key:"advance",value:function(e){for(var t=0;!this.prepareAdvanceAll(e);)if(t++>100)throw new Error("Depth exceeded resolving collisions");this.balls.forEach((function(t){t.update(e)}))}},{key:"prepareAdvanceAll",value:function(e){var t=this;return this.pairs.every((function(n){return t.prepareAdvancePair(n.a,n.b,e)}))&&this.balls.every((function(n){return t.prepareAdvanceToCushions(n,e)}))}},{key:"prepareAdvancePair",value:function(e,t,n){if(u.willCollide(e,t,n)){var i=u.collide(e,t);return this.outcome.push(g.k.collision(e,t,i)),!1}return!0}},{key:"prepareAdvanceToCushions",value:function(e,t){if(!e.onTable())return!0;var n=e.futurePosition(t);if(Math.abs(n.y)<i.H.tableY&&Math.abs(n.x)<i.H.tableX)return!0;var a=s.bounceAny(e,t);if(a)return this.outcome.push(g.k.cushion(e,a)),!1;var r=h.T.findBouncing(e,t);if(r){var o=r.bounce(e);return this.outcome.push(g.k.cushion(e,o)),!1}var l=f.f.findPocket(e,t);if(l){var c=l.fall(e,t);return this.outcome.push(g.k.pot(e,c)),!1}return!0}},{key:"allStationary",value:function(){return this.balls.every((function(e){return!e.inMotion()||!e.onTable()}))}},{key:"hit",value:function(){this.cue.hit(this.balls[0])}},{key:"serialise",value:function(){return{balls:this.balls.map((function(e){return e.serialise()})),aim:this.cue.aim.copy()}}},{key:"updateFromSerialised",value:function(e){e.balls&&this.balls.forEach((function(t,n){return l.e.updateFromSerialised(t,e.balls[n])})),e.aim&&(this.cue.aim=d.f.fromJson(e.aim))}},{key:"shortSerialise",value:function(){return this.balls.map((function(e){return[e.pos.x,e.pos.y]})).reduce((function(e,t){return e.concat(t)}),[])}},{key:"updateFromShortSerialised",value:function(e){this.balls.forEach((function(t,n){t.pos.x=e[2*n],t.pos.y=e[2*n+1]}))}}])&&x(t.prototype,n),a&&x(t,a),e}()},"./src/utils/utils.ts":(e,t,n)=>{n.d(t,{AA:()=>u,Bh:()=>o,KO:()=>l,Ls:()=>c,NM:()=>h,a1:()=>s,bM:()=>a,up:()=>r,wK:()=>f});var i=n("./node_modules/three/build/three.module.js"),a=new i.Pa4(0,0,0),r=new i.Pa4(0,0,1);function o(e){return new i.Pa4(e.x,e.y,e.z)}function s(e){return r.clone().cross(e)}function l(e){return e.clone().normalize()}function c(e,t){return e.clone().add(t).dot(e)<=0}function u(e){return new i.Pa4(1,0,0).applyAxisAngle(r,e)}function h(e){return Math.round(1e3*(e+Number.EPSILON))/1e3}function f(e){return e.x=h(e.x),e.y=h(e.y),e.z=h(e.z),e}},"./src/view/tablegeometry.ts":(e,t,n)=>{n.d(t,{H:()=>l});var i=n("./node_modules/three/build/three.module.js"),a=n("./src/model/physics/knuckle.ts"),r=n("./src/model/physics/pocket.ts");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"addToScene",value:function(t){e.knuckles.forEach((function(n){return e.knuckleCylinder(n,t)})),e.pocketCenters.forEach((function(n){return e.knuckleCylinder(n,t)}))}},{key:"knuckleCylinder",value:function(t,n){e.cylinder(t.pos,t.radius,.75,n).position.setZ(-.125)}},{key:"cylinder",value:function(t,n,a,r){var o=new i.fHI(n,n,a,16),s=new i.Kj0(o,e.material);return s.position.copy(t),s.geometry.applyMatrix4((new i.yGw).identity().makeRotationAxis(new i.Pa4(1,0,0),Math.PI/2)),r.add(s),s}},{key:"addCushions",value:function(t){e.plane(new i.Pa4(0,0,-5.5),2*e.X,2*e.Y,10,t);var n=.75,a=-.125,r=Math.abs(e.pockets.pocketNW.knuckleNE.pos.x-e.pockets.pocketN.knuckleNW.pos.x),o=Math.abs(e.pockets.pocketNW.knuckleSW.pos.y-e.pockets.pocketSW.knuckleNW.pos.y);e.plane(new i.Pa4(e.X+.5,0,a),1,o,n,t),e.plane(new i.Pa4(-e.X-.5,0,a),1,o,n,t),e.plane(new i.Pa4(-e.X/2,e.Y+.5,a),r,1,n,t),e.plane(new i.Pa4(-e.X/2,-e.Y-.5,a),r,1,n,t),e.plane(new i.Pa4(e.X/2,e.Y+.5,a),r,1,n,t),e.plane(new i.Pa4(e.X/2,-e.Y-.5,a),r,1,n,t)}},{key:"plane",value:function(t,n,a,r,o){var s=new i.DvJ(n,a,r),l=new i.Kj0(s,e.material);l.receiveShadow=!0,l.position.copy(t),o.add(l)}}],(n=null)&&o(t.prototype,n),a&&o(t,a),e}();s(l,"tableX",21.5),s(l,"tableY",10.5),s(l,"X",l.tableX+.5),s(l,"Y",l.tableY+.5),s(l,"PX",l.tableX+.8),s(l,"PY",l.tableY+.8),s(l,"knuckleInset",1.6),s(l,"knuckleRadius",.31),s(l,"middleKnuckleInset",1.385),s(l,"middleKnuckleRadius",.2),s(l,"cornerRadius",1.1),s(l,"middleRadius",.9),s(l,"pockets",{pocketNW:{pocket:new r.f(new i.Pa4(-l.PX,l.PY,0),l.cornerRadius),knuckleNE:new a.T(new i.Pa4(-l.X+l.knuckleInset,l.Y+l.knuckleRadius,0),l.knuckleRadius),knuckleSW:new a.T(new i.Pa4(-l.X-l.knuckleRadius,l.Y-l.knuckleInset,0),l.knuckleRadius)},pocketN:{pocket:new r.f(new i.Pa4(0,l.PY+.7,0),l.middleRadius),knuckleNE:new a.T(new i.Pa4(l.middleKnuckleInset,l.Y+l.middleKnuckleRadius,0),l.middleKnuckleRadius),knuckleNW:new a.T(new i.Pa4(-l.middleKnuckleInset,l.Y+l.middleKnuckleRadius,0),l.middleKnuckleRadius)},pocketS:{pocket:new r.f(new i.Pa4(0,-l.PY-.7,0),l.middleRadius),knuckleSE:new a.T(new i.Pa4(l.middleKnuckleInset,-l.Y-l.middleKnuckleRadius,0),l.middleKnuckleRadius),knuckleSW:new a.T(new i.Pa4(-l.middleKnuckleInset,-l.Y-l.middleKnuckleRadius,0),l.middleKnuckleRadius)},pocketNE:{pocket:new r.f(new i.Pa4(l.PX,l.PY,0),l.cornerRadius),knuckleNW:new a.T(new i.Pa4(l.X-l.knuckleInset,l.Y+l.knuckleRadius,0),l.knuckleRadius),knuckleSE:new a.T(new i.Pa4(l.X+l.knuckleRadius,l.Y-l.knuckleInset,0),l.knuckleRadius)},pocketSE:{pocket:new r.f(new i.Pa4(l.PX,-l.PY,0),l.cornerRadius),knuckleNE:new a.T(new i.Pa4(l.X+l.knuckleRadius,-l.Y+l.knuckleInset,0),l.knuckleRadius),knuckleSW:new a.T(new i.Pa4(l.X-l.knuckleInset,-l.Y-l.knuckleRadius,0),l.knuckleRadius)},pocketSW:{pocket:new r.f(new i.Pa4(-l.PX,-l.PY,0),l.cornerRadius),knuckleSE:new a.T(new i.Pa4(-l.X+l.knuckleInset,-l.Y-l.knuckleRadius,0),l.knuckleRadius),knuckleNW:new a.T(new i.Pa4(-l.X-l.knuckleRadius,-l.Y+l.knuckleInset,0),l.knuckleRadius)}}),s(l,"knuckles",[l.pockets.pocketNW.knuckleNE,l.pockets.pocketNW.knuckleSW,l.pockets.pocketN.knuckleNW,l.pockets.pocketN.knuckleNE,l.pockets.pocketS.knuckleSW,l.pockets.pocketS.knuckleSE,l.pockets.pocketNE.knuckleNW,l.pockets.pocketNE.knuckleSE,l.pockets.pocketSE.knuckleNE,l.pockets.pocketSE.knuckleSW,l.pockets.pocketSW.knuckleSE,l.pockets.pocketSW.knuckleNW]),s(l,"pocketCenters",[l.pockets.pocketNW.pocket,l.pockets.pocketSW.pocket,l.pockets.pocketN.pocket,l.pockets.pocketS.pocket,l.pockets.pocketNE.pocket,l.pockets.pocketSE.pocket]),s(l,"material",new i.xoR({color:4478361,wireframe:!1,flatShading:!0,transparent:!0,opacity:.4}))}},e=>{var t;t="./src/diagrams.ts",e(e.s=t)}]);